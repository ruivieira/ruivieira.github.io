<!doctype html><html lang=en><head><script data-goatcounter=https://ruivieira-dev.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script src=https://unpkg.com/@alpinejs/intersect@3.x.x/dist/cdn.min.js></script><script src=https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js></script><script type=module src=https://ruivieira.dev/js/deeplinks/deeplinks.js></script><link rel=preload href=https://ruivieira.dev/lib/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://ruivieira.dev/lib/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://ruivieira.dev/lib/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://ruivieira.dev/fonts/firacode/FiraCode-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://ruivieira.dev/fonts/vollkorn/Vollkorn-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=stylesheet href=https://ruivieira.dev/css/kbd.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Rui Vieira</title>
<link rel=canonical href=https://ruivieira.dev/blog/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Blog"><meta property="og:description" content="A collection of my blog posts."><meta property="og:type" content="website"><meta property="og:url" content="https://ruivieira.dev/blog/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Blog"><meta name=twitter:description content="A collection of my blog posts."><link rel=stylesheet href=https://ruivieira.dev/css/styles.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://ruivieira.dev/images/favicon.ico><link href=https://ruivieira.dev/blog/index.xml rel=alternate type=application/rss+xml title="Rui Vieira"></head><style>html{padding:4px!important;font-family:Exchange,Georgia,serif!important;color:#000!important;font-size:14px!important;hyphens:auto!important}html,body,div,span,p,ol,ul,li,table,figure{margin:0!important;padding:0!important;border:0!important;vertical-align:baseline!important;border-spacing:0!important}</style><body><div class=gazette><div class="pageHeader doNotPrint"><a style=text-align:left;left:25px href=https://ruivieira.dev/><img src=https://ruivieira.dev/images/logo.png width=30px height=30px></a>
<a style=text-align:right;right:25px href=https://github.com/ruivieira/ruivieira.github.io/blob/master/blog/index.html><svg xmlns="http://www.w3.org/2000/svg" width="92pt" height="92pt" viewBox="0 0 92 92"><path d="M90.156 41.965 50.036 1.848a5.913 5.913.0 00-8.368.0l-8.332 8.332 10.566 10.566a7.03 7.03.0 017.23 1.684 7.043 7.043.0 011.673 7.277l10.183 10.184a7.026 7.026.0 017.278 1.672 7.04 7.04.0 010 9.957 7.045 7.045.0 01-9.961.0 7.038 7.038.0 01-1.532-7.66l-9.5-9.497V59.36a7.04 7.04.0 011.86 11.29 7.04 7.04.0 01-9.957.0 7.04 7.04.0 010-9.958 7.034 7.034.0 012.308-1.539V33.926a7.001 7.001.0 01-2.308-1.535 7.049 7.049.0 01-1.516-7.7L29.242 14.273 1.734 41.777a5.918 5.918.0 000 8.371L41.855 90.27a5.92 5.92.0 008.368.0l39.933-39.934a5.925 5.925.0 000-8.371"/></g></svg></a></div><div class=scrollSection><h1 class=scrollTitle><a href=index.html>Rui Vieira's blog</a></h1></div><div class=scrollColumns style=column-width:35ch;column-count:5;max-width:255ch><div class=scrollSection><h1>2024</h1></div><div class=scrollSection><h2 class=scrollSection>BSD mascot</h2></div><div class="post-content scrollParagraph"><p><span class=date>January, 21st</span> - There is an interesting post by <a href=https://www.jacobelder.com/2024/01/17/director-of-toy-story-also-drew-bsd-daemon.html>Jacob Elder</a> where I learned that John Lassetter (of <em>Toy Story</em>, <em>A Bug&rsquo;s Life</em>, <em>Cars</em> and <em>Cars 2</em>) also created the BSD mascot.</p><p>Read more about <a href=https://ruivieira.dev/unix.html>UNIX</a> in general or <a href=https://ruivieira.dev/unix.html#berkeley-software-distribution>BSD</a> in particular.</p></div><div class=scrollSection><h1>2023</h1></div><div class=scrollSection><h2 class=scrollSection>KServe logging</h2></div><div class="post-content scrollParagraph"><p><span class=date>September, 27th</span> - In <a href=https://ruivieira.dev/kubernetes.html>Kubernetes</a>, labels serve as a mechanism to organize and select groupings of objects. They are key-value pairs associated with objects and can be used to apply operations on a subset of objects. <a href=https://ruivieira.dev/kustomize.html>Kustomize</a> is a tool that allows us to manage these configurations efficiently.</p><p>Let’s consider a project named <code>foo</code>. The project has various Kubernetes objects labeled with <code>app: foo</code>. Now, suppose there is a requirement to change the label to <code>app: bar</code>. This is where Kustomize’s <code>commonLabels</code> feature comes in handy.</p><pre tabindex=0><code class=scrollCodeBlock>Project Name: foo
Existing Label: app: foo
New Label: app: bar
</code></pre><p>Assume we have a <code>kustomization.yaml</code> file referencing the resources of project <code>foo</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:navy>apiVersion</span>:<span style=color:#bbb> </span>kustomize.config.k8s.io/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>kind</span>:<span style=color:#bbb> </span>Kustomization<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- deployment.yaml<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- service.yaml<span style=color:#bbb>
</span></span></span></code></pre></div><p>To change the label from <code>app: foo</code> to <code>app: bar</code>, we can use the <code>commonLabels</code> field in the <code>kustomization.yaml</code> file:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:navy>apiVersion</span>:<span style=color:#bbb> </span>kustomize.config.k8s.io/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>kind</span>:<span style=color:#bbb> </span>Kustomization<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>resources</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- deployment.yaml<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- service.yaml<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>commonLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>app</span>:<span style=color:#bbb> </span>bar<span style=color:#bbb>
</span></span></span></code></pre></div><p>When you run <code>kustomize build</code>, it will add or override the existing <code>app</code> label with <code>app: bar</code> on every resource and selector specified in the <code>kustomization.yaml</code> file. This ensures that all the resources are uniformly labeled with <code>app: bar</code>, making them identifiable and manageable under the new label.</p></div><div class=scrollSection><h2 class=scrollSection>Orca's fashion</h2></div><div class="post-content scrollParagraph"><p><span class=date>September, 18th</span> - The waters around the Iberian Peninsula (mostly reported off the Spanish and Portuguese coasts) have been of interest for marine biologists due to a <a href=https://en.wikipedia.org/wiki/Iberian_orca_attacks>notable increase in interactions between orcas and boats</a>. Having intricate social structures and intelligence, orcas display behaviours that may be influenced by a multitude of factors such as environmental and social ones.</p><p>Scientists postulate that these interactions might be representative of a transient &ldquo;fad&rdquo; within orca pods. For perspective, in 1987, there was an observable trend among the southern resident orcas of Puget Sound, who took to <em>carrying dead salmon on their heads</em>. This behaviour, while seemingly anomalous at the time, did not persist.</p><figure class=scrollCaptionedFigure><img src=https://ruivieira.dev/assets/blog_orcas.jpg alt=blog_orcas.jpg loading=lazy></figure></div><div class=scrollSection><h2 class=scrollSection>Modernism and Gazette</h2></div><div class="post-content scrollParagraph"><p><span class=date>September, 16th</span> - Recently, I&rsquo;ve been reading a fair bit about John Dos Passos, and while I haven&rsquo;t still read any of his books, his approach to literature seems quite avant-garde for his time. The &ldquo;<em>USA Trilogy</em>&rdquo; is frequently cited as a significant exploration of American life in the early 20th century, using techniques like the &ldquo;<em>Newsreel</em>&rdquo; and &ldquo;<em>Camera Eye</em>&rdquo; to tell his narratives. From the discussions and summaries I&rsquo;ve encountered, Dos Passos seemed to have a knack for interweaving fiction with the pressing sociopolitical issues of his era. It&rsquo;s intriguing to think about the depth of his works without having directly experienced them.</p><figure class=scrollCaptionedFigure><img src=https://ruivieira.dev/assets/john_dos_passos.jpg alt=john_dos_passos.jpg loading=lazy></figure><h3 id=gazette-and-scroll x-intersect="currentHeading = '#gazette-and-scroll'">Gazette and scroll</h3><p>I was considering moving the entirety of the blog (not the site, just these pages) to <code>scroll</code>.
Unfortunately, <code>scroll</code> is not a great fit for the rest of the site&rsquo;s workflow.</p><p>At the moment, it&rsquo;s a bit of a compromise. I&rsquo;m using the <em>Gazette</em> style for the blog page, but it&rsquo;s just the CSS.
The underlying process of building the site is the same (still using Markdown).</p><h3 id=a-thought-on-important x-intersect="currentHeading = '#a-thought-on-important'">A thought on !important</h3><p>In <a href>CSS</a>, <code>!important</code> is really not a good idea. It&rsquo;s make debugging very time-consuming and fundamentally breaks the <em>Cascading</em> part of CSS.</p><h3 id=reducing-software-bugs x-intersect="currentHeading = '#reducing-software-bugs'">Reducing software bugs</h3><p>Just read Daniel J. Bernstein&rsquo;s &ldquo;<em>Some thoughts on security after ten years of qmail 1.0</em>&rdquo; <a href=https://dl.acm.org/doi/abs/10.1145/1314466.1314467>paper</a> on mitigating software bugs, I found these to be the main takeaways:</p><ol><li><p><strong>Code Reviews Matter</strong>: By thoroughly reviewing your code, you can get a sense of its vulnerability to bugs. This isn&rsquo;t just about finding immediate errors, but evaluating the overall quality of your software-development approach. Adjust your strategies based on these reviews for better outcomes.</p></li><li><p><strong>Measuring Bugs</strong>: There are two primary ways to gauge the &lsquo;bugginess&rsquo; of software—either by looking at the bugs per specific task or bugs per line of code. Each approach has its merits. While the former can give insights into the efficiency of a task, the latter can be an indicator of how long debugging might take.</p></li><li><p><strong>Eliminate Risky Habits</strong>: In coding, as in life, some habits are more prone to mistakes than others. Identifying these risky behaviours and addressing them head-on can dramatically cut down on errors. This might even mean reshaping the coding environment or tools used.</p></li><li><p><strong>The Virtue of Brevity</strong>: A larger codebase naturally has more room for errors. If two processes achieve the same result, but one does it with fewer lines of code, the latter is generally preferable. It&rsquo;s not about cutting corners but about efficiency and clarity.</p></li><li><p><strong>Access Control</strong>: Just as you wouldn&rsquo;t give every employee a key to the company safe, not all code should have unrestricted access. By architecting systems that limit code permissions, you add another layer of protection against potential issues.</p></li></ol><p>In conclusion, a proactive, thoughtful approach to coding—paired with smart strategies and tools can significantly reduce software bugs.</p><h3 id=issue-bankruptcy x-intersect="currentHeading = '#issue-bankruptcy'">Issue bankruptcy</h3><p>Today <a href=https://github.com/lodash/lodash>Lodash</a> declared &ldquo;<a href="https://github.com/lodash/lodash/issues?q=is%3Aissue+is%3Aclosed+label%3A%22issue+bankruptcy%22">issue bankruptcy</a>&rdquo; and closed 363 issues 325 PRs to start afresh.</p></div><div class=scrollSection><h2 class=scrollSection>KNative missing CRDs</h2></div><div class="post-content scrollParagraph"><p><span class=date>September, 7th</span> - If you&rsquo;re using <a href=https://ruivieira.dev/kubernetes.html>Kubernetes</a> 1.27.3 to install <a href=https://ruivieira.dev/posts/kserve.html>KServe</a> 0.9 or 0.10, you might encounter this error:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-text data-lang=text><span style=display:flex><span>resource mapping not found for name: &#34;activator&#34; namespace: &#34;knative-serving&#34; 
</span></span><span style=display:flex><span>from &#34;https://github.com/knative/serving/releases/download/knative-v1.7.0/serving-core.yaml&#34;: 
</span></span><span style=display:flex><span>no matches for kind &#34;HorizontalPodAutoscaler&#34; in version &#34;autoscaling/v2beta2&#34;
</span></span><span style=display:flex><span>ensure CRDs are installed first
</span></span><span style=display:flex><span>resource mapping not found for name: &#34;webhook&#34; namespace: &#34;knative-serving&#34; 
</span></span><span style=display:flex><span>from &#34;https://github.com/knative/serving/releases/download/knative-v1.7.0/serving-core.yaml&#34;: 
</span></span><span style=display:flex><span>no matches for kind &#34;HorizontalPodAutoscaler&#34; in version &#34;autoscaling/v2beta2&#34;
</span></span></code></pre></div><p>Here&rsquo;s the main issue:</p><p>Kubernetes 1.27.3 no longer supports the <code>autoscaling/v2beta2</code> API version of <code>HorizontalPodAutoscaler</code>. The Kubernetes release notes state:</p><blockquote class=scrollQuote><p>The autoscaling/v2beta2 API version of <code>HorizontalPodAutoscaler</code> is no longer served as of v1.26.</p></blockquote><p>Meanwhile, KNative&rsquo;s release notes indicate that its v1.7 version is validated for Kubernetes v1.24 and v1.25 only, which leads to this compatibility problem.</p><p>Possible solutions:</p><ol><li><strong>Downgrade</strong>: Use Minikube v1.25 to ensure KNative works without changes.</li><li><strong>Edit the Manifests</strong>: Adjust the manifests to resolve the version discrepancy.</li><li><strong>Wait for an Update</strong>: A future KNative release will likely fix this compatibility issue.</li></ol><p>A note that if you go the <strong>Downgrade</strong> route, you might see the following warning on your logs:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-text data-lang=text><span style=display:flex><span>Warning: autoscaling/v2beta2 HorizontalPodAutoscaler is deprecated in v1.23+, unavailable in v1.26+;
</span></span><span style=display:flex><span>use autoscaling/v2 HorizontalPodAutoscaler
</span></span></code></pre></div></div><div class=scrollSection><h2 class=scrollSection>JUnit null and empty sources</h2></div><div class="post-content scrollParagraph"><p><span class=date>September, 5th</span> - Today I learned about <a href=https://ruivieira.dev/junit.html>JUnit</a>&rsquo;s ability to use <code>null</code> sources in conjunction with <code>@ParamterizedTest</code>. Example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-java data-lang=java><span style=display:flex><span>@ParameterizedTest<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>@NullAndEmptySource<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>@ValueSource(strings<span style=color:#bbb> </span><span style=font-weight:700>=</span><span style=color:#bbb> </span>{<span style=color:#b84>&#34;test&#34;</span>,<span style=color:#bbb> </span><span style=color:#b84>&#34;JUnit&#34;</span>})<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#458;font-weight:700>void</span><span style=color:#bbb> </span><span style=color:#900;font-weight:700>nullAndEmptyTest</span>(String<span style=color:#bbb> </span>text)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>Assertions.<span style=color:teal>assertTrue</span>(text<span style=color:#bbb> </span><span style=font-weight:700>==</span><span style=color:#bbb> </span><span style=font-weight:700>null</span><span style=color:#bbb> </span><span style=font-weight:700>||</span><span style=color:#bbb> </span>text.<span style=color:teal>trim</span>().<span style=color:teal>isEmpty</span>()<span style=color:#bbb> </span><span style=font-weight:700>||</span><span style=color:#bbb> </span><span style=color:#b84>&#34;test&#34;</span>.<span style=color:teal>equals</span>(text)<span style=color:#bbb> </span><span style=font-weight:700>||</span><span style=color:#bbb> </span><span style=color:#b84>&#34;JUnit&#34;</span>.<span style=color:teal>equals</span>(text));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>There&rsquo;s also <code>@NullSource</code> and <code>@EmptySource</code>.</p></div><div class=scrollSection><h2 class=scrollSection>LunarVim</h2></div><div class="post-content scrollParagraph"><p><span class=date>September, 4th</span> - Been trying out <a href=https://ruivieira.dev/neovim.html>NeoVim</a> in the format of LunarVim.</p><p>To use with a GUI on macOS, I use <a href=https://ruivieira.dev/neovim.html#neovide>NeoVide</a>, with the command</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-shell data-lang=shell><span style=display:flex><span>neovide --neovim-bin ~/.local/bin/lvim --multigrid --maximized --frame none
</span></span></code></pre></div><p>If you are planning on using Neovim I recommend using a <code>tree-sitter</code>-aware theme. You can find a list <a href=https://github.com/rockerBOO/awesome-neovim#tree-sitter-supported-colorscheme>here</a>.
My personal favourites are <a href=https://github.com/ishan9299/modus-theme-vim>modus</a> and <a href=https://github.com/sainnhe/gruvbox-material>gruvbox-material</a>.</p></div><div class=scrollSection><h2 class=scrollSection>Hatch Poetry</h2></div><div class="post-content scrollParagraph"><p><span class=date>September, 3rd</span> - I&rsquo;ve been a long-time user of <a href=https://ruivieira.dev/python-environments.html#poetry>Poetry</a> for my <a href=https://ruivieira.dev/python.html>Python</a> projects, and it&rsquo;s been a welcome change.
However, my recent exploration into <a href=https://ruivieira.dev/python-environments.html#hatch>Hatch</a> has sparked my interest.</p><p>Poetry simplifies dependency management with its unified <code>pyproject.toml</code>, but Hatch excels in scenarios requiring complex workflows.
A common personal use-case is Docker multi-stage builds. Hatch, with its conventional <code>requirements.txt</code> and <code>setup.py</code>, offers more granular control, making complex configurations easier.</p><p>Hatch also aligns closely with the existing Python ecosystem due to its use of traditional setup files, linking old with new workflows, ensuring a better integration.</p><p>For instance, if using a container image manifest such as</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#998;font-style:italic># Use a base Python image</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=font-weight:700>FROM</span><span style=color:#b84> python:3.9-slim as base</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#998;font-style:italic># Set up a working directory</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=font-weight:700>WORKDIR</span><span style=color:#b84> /app</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#998;font-style:italic># Copy requirements and install dependencies</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=font-weight:700>COPY</span> requirements.txt .<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=font-weight:700>RUN</span> pip install -r requirements.txt<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#998;font-style:italic># Copy the rest of the application</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=font-weight:700>COPY</span> . .<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#998;font-style:italic># Other Docker configurations...</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span></code></pre></div><p>Whereas with Poetry, you might need to install it within the Docker image and use <code>poetry export</code> to generate a <code>requirements.txt</code> equivalent, with Hatch, since it supports the traditional <code>requirements.txt</code>, integration with multi-stage builds can be simpler.</p></div><div class=scrollSection><h2 class=scrollSection>Exception Bubbling in Python</h2></div><div class="post-content scrollParagraph"><p><span class=date>September, 2nd</span> - One aspect of <a href=https://ruivieira.dev/java.html>Java</a> that occasionally nudges at me is its explicit approach to exception handling.
Java requires developers to either handle exceptions via <code>try-catch</code> blocks or declare them in method signatures. While it does enforce robustness, it sometimes feels a bit too constrained, especially when compared to the flexible nature of Python.</p><p>Recently, I crafted a solution in Python for <a href=https://github.com/ruivieira/k8s.py>k8sutils</a>.
Instead of the usual explicit exception handling or modifying method signatures, I created a <a href=https://ruivieira.dev/python.html>Python</a> decorator - akin to annotations in Java - that substitutes an exception for another without altering the underlying code. Here&rsquo;s what it looks like:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>import</span> <span style=color:#555>functools</span>
</span></span><span style=display:flex><span><span style=font-weight:700>import</span> <span style=color:#555>subprocess</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>rethrow</span>(exception_type<span style=font-weight:700>=</span><span style=color:#900;font-weight:700>Exception</span>):
</span></span><span style=display:flex><span>    <span style=color:#b84>&#34;&#34;&#34;Rethrow a CalledProcessError as the specified exception type.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>decorator</span>(func):
</span></span><span style=display:flex><span>        @functools.wraps(func)
</span></span><span style=display:flex><span>        <span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>wrapper</span>(<span style=font-weight:700>*</span>args, <span style=font-weight:700>**</span>kwargs):
</span></span><span style=display:flex><span>            <span style=font-weight:700>try</span>:
</span></span><span style=display:flex><span>                <span style=font-weight:700>return</span> func(<span style=font-weight:700>*</span>args, <span style=font-weight:700>**</span>kwargs)
</span></span><span style=display:flex><span>            <span style=font-weight:700>except</span> subprocess<span style=font-weight:700>.</span>CalledProcessError <span style=font-weight:700>as</span> e:
</span></span><span style=display:flex><span>                <span style=font-weight:700>raise</span> exception_type(<span style=color:#b84>f</span><span style=color:#b84>&#34;Command failed: </span><span style=color:#b84>{</span>e<span style=font-weight:700>.</span>cmd<span style=color:#b84>}</span><span style=color:#b84>. Error: </span><span style=color:#b84>{</span>e<span style=font-weight:700>.</span>output<span style=color:#b84>}</span><span style=color:#b84>&#34;</span>) <span style=font-weight:700>from</span> <span style=color:#555>e</span>
</span></span><span style=display:flex><span>        <span style=font-weight:700>return</span> wrapper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> decorator
</span></span></code></pre></div><p>Using this decorator, it becomes straightforward to alter the exception being thrown:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-python data-lang=python><span style=display:flex><span>@rethrow(<span style=color:#900;font-weight:700>ValueError</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>get</span>(namespace<span style=font-weight:700>=</span><span style=font-weight:700>None</span>):
</span></span><span style=display:flex><span>    <span style=color:#b84>&#34;&#34;&#34;Get all deployments in the cluster.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    cmd <span style=font-weight:700>=</span> <span style=color:#b84>&#34;kubectl get deployments -o json&#34;</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> namespace:
</span></span><span style=display:flex><span>        cmd <span style=font-weight:700>+=</span> <span style=color:#b84>f</span><span style=color:#b84>&#34; -n </span><span style=color:#b84>{</span>namespace<span style=color:#b84>}</span><span style=color:#b84>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    result <span style=font-weight:700>=</span> subprocess<span style=font-weight:700>.</span>run(cmd, shell<span style=font-weight:700>=</span><span style=font-weight:700>True</span>, check<span style=font-weight:700>=</span><span style=font-weight:700>True</span>, capture_output<span style=font-weight:700>=</span><span style=font-weight:700>True</span>, text<span style=font-weight:700>=</span><span style=font-weight:700>True</span>)
</span></span><span style=display:flex><span>    deployments <span style=font-weight:700>=</span> json<span style=font-weight:700>.</span>loads(result<span style=font-weight:700>.</span>stdout)
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> deployments
</span></span></code></pre></div><p>The <code>@rethrow(ValueError)</code> decorator automatically translates a <code>CalledProcessError</code> to a <code>ValueError</code> without the need to change the method&rsquo;s code.</p><p>For another example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=scrollCodeBlock class=language-python data-lang=python><span style=display:flex><span>@rethrow(<span style=color:#900;font-weight:700>RuntimeError</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>delete_deployment</span>(deployment_name):
</span></span><span style=display:flex><span>    <span style=color:#b84>&#34;&#34;&#34;Delete a specific deployment.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    cmd <span style=font-weight:700>=</span> <span style=color:#b84>f</span><span style=color:#b84>&#34;kubectl delete deployment </span><span style=color:#b84>{</span>deployment_name<span style=color:#b84>}</span><span style=color:#b84>&#34;</span>
</span></span><span style=display:flex><span>    subprocess<span style=font-weight:700>.</span>run(cmd, shell<span style=font-weight:700>=</span><span style=font-weight:700>True</span>, check<span style=font-weight:700>=</span><span style=font-weight:700>True</span>)
</span></span></code></pre></div><p>Here, instead of bubbling up the generic <code>CalledProcessError</code>, any error encountered will raise a <code>RuntimeError</code>.</p></div></div><div class="pageFooter doNotPrint"><a href=https://github.com/ruivieira/ruivieira.github.io/blob/master/blog/index.html><svg xmlns="http://www.w3.org/2000/svg" width="92pt" height="92pt" viewBox="0 0 92 92"><path d="M90.156 41.965 50.036 1.848a5.913 5.913.0 00-8.368.0l-8.332 8.332 10.566 10.566a7.03 7.03.0 017.23 1.684 7.043 7.043.0 011.673 7.277l10.183 10.184a7.026 7.026.0 017.278 1.672 7.04 7.04.0 010 9.957 7.045 7.045.0 01-9.961.0 7.038 7.038.0 01-1.532-7.66l-9.5-9.497V59.36a7.04 7.04.0 011.86 11.29 7.04 7.04.0 01-9.957.0 7.04 7.04.0 010-9.958 7.034 7.034.0 012.308-1.539V33.926a7.001 7.001.0 01-2.308-1.535 7.049 7.049.0 01-1.516-7.7L29.242 14.273 1.734 41.777a5.918 5.918.0 000 8.371L41.855 90.27a5.92 5.92.0 008.368.0l39.933-39.934a5.925 5.925.0 000-8.371"/></g></svg></a></div></div></body></html>