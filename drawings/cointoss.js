new p5(o=>{let d=[];function t(){setTimeout(()=>{var s,i;d.length<1e3&&(i=o.random(o.TWO_PI),s=5*o.cos(i),i=5*o.sin(i),d.push(new l(o.width/2,o.height/2,10,s,i))),t()},2e3)}o.setup=function(){var s=o.createCanvas(600,600).elt;document.querySelector("#canvas").appendChild(s),o.frameRate(30),t()},o.draw=function(){var i,t,e=200,h=o.width/2,n=o.height/2;o.ellipse(h,n,400,400);for(let s=d.length-1;0<=s;s--)d[s].applyGravity(),d[s].update(),d[s].display(),d[s].canCollide()&&d[s].isMovingOutside(h,n,e)&&(o.random()<.25?d[s].isCompletelyOutside(h,n,e)&&d.splice(s,1):(i=d[s].bounceAndSplit(h,n,e),d.splice(s,1),0<(t=d.length+i.length-1e3)&&d.splice(0,t),d.push(...i))),d[s].cooldownUpdate()};class l{constructor(s,i,t,e,h){this.x=s,this.y=i,this.r=t,this.xSpeed=e,this.ySpeed=h,this.cooldown=0,this.wasInside=!0}applyGravity(){this.ySpeed+=.1}update(){this.x+=this.xSpeed,this.y+=this.ySpeed}display(){o.ellipse(this.x,this.y,2*this.r,2*this.r)}cooldownUpdate(){0<this.cooldown&&this.cooldown--}canCollide(){return 0===this.cooldown}isOutside(s,i,t){return o.dist(this.x,this.y,s,i)>t-this.r}isCompletelyOutside(s,i,t){return o.dist(this.x,this.y,s,i)>t+this.r}isMovingOutside(s,i,t){return this.isOutside(s,i,t)?!!this.wasInside&&!(this.wasInside=!1):!(this.wasInside=!0)}bounceAndSplit(s,i,t){var s=this.x-s,i=this.y-i,e=o.sqrt(s*s+i*i),e=this.xSpeed*(s/=e)+this.ySpeed*(i/=e),s=this.xSpeed-2*e*s,e=this.ySpeed-2*e*i,i=.9*this.r,h=o.PI/4,n=new l(this.x,this.y,i,s*o.cos(h)-e*o.sin(h),s*o.sin(h)+e*o.cos(h)),i=new l(this.x,this.y,i,s*o.cos(-h)-e*o.sin(-h),s*o.sin(-h)+e*o.cos(-h));return n.cooldown=30,i.cooldown=30,[n,i]}}o.mouseClicked=function(){d=[],t()}});