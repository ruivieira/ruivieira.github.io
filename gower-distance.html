<!doctype html><html lang=en-uk><head><script data-goatcounter=https://ruivieira-dev.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script src=https://unpkg.com/@alpinejs/intersect@3.x.x/dist/cdn.min.js></script>
<script src=https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js></script>
<script type=module src=/js/deeplinks/deeplinks.js></script>
<link rel=preload href=/lib/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/fonts/firacode/FiraCode-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/fonts/vollkorn/Vollkorn-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=stylesheet href=/css/kbd.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Gower distance Â· Rui Vieira</title><link rel=canonical href=/gower-distance.html><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Gower distance"><meta property="og:description" content="For features $x_i={x_{i1},\dots,x_{ip}}$ and $x_j={x_{j1},\dots,x_{jp}}$, the Gower similarity matrix 1 can be defined as
$$ S_{\text{Gower}}(x_i, x_j) = \frac{\sum_{k=1}^p s_{ijk}\delta_{ijk}}{\sum_{k=1}^p \delta_{ijk}}. $$
For each feature $k=1,\dots,p$ a score $s_{ijk}$ is calculated. A quantity $\delta_{ijk}$ is also calculated having possible values ${0,1}$ depending on whether the variables $x_i$ and $x_j$ can be compared or not (/e.g./ if they have different types).
A special case2 for when no missing values exist can be formulated as the mean of the Gower similarity scores, that is:"><meta property="og:type" content="article"><meta property="og:url" content="/gower-distance.html"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2023-09-02T17:28:34+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gower distance"><meta name=twitter:description content="For features $x_i={x_{i1},\dots,x_{ip}}$ and $x_j={x_{j1},\dots,x_{jp}}$, the Gower similarity matrix 1 can be defined as
$$ S_{\text{Gower}}(x_i, x_j) = \frac{\sum_{k=1}^p s_{ijk}\delta_{ijk}}{\sum_{k=1}^p \delta_{ijk}}. $$
For each feature $k=1,\dots,p$ a score $s_{ijk}$ is calculated. A quantity $\delta_{ijk}$ is also calculated having possible values ${0,1}$ depending on whether the variables $x_i$ and $x_j$ can be compared or not (/e.g./ if they have different types).
A special case2 for when no missing values exist can be formulated as the mean of the Gower similarity scores, that is:"><link rel=stylesheet href=/css/styles.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=images/favicon.ico></head><body class="max-width mx-auto px3 ltr" x-data="{currentHeading: undefined}"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-eye fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-eye fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=/draw/>Drawings</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li></ul></span><br><div id=share style=display:none></div><div id=toc><h4>Contents</h4><nav id=TableOfContents><ul><li><a href=#scoring :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#scoring' }">Scoring</a></li><li><a href=#numerical-variables :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#numerical-variables' }">Numerical variables</a></li><li><a href=#categorical-variables :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#categorical-variables' }">Categorical variables</a></li><li><a href=#example :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#example' }">Example</a></li><li><a href=#range-impact :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#range-impact' }">Range impact</a></li><li><a href=#varying-bounds :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#varying-bounds' }">Varying bounds</a></li><li><a href=#varying-range-directly :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#varying-range-directly' }">Varying range directly</a></li><li><a href=#categorical-impact :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#categorical-impact' }">Categorical impact</a></li><li><a href=#missing-range :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#missing-range' }">Missing range</a></li></ul></nav></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Gower distance</h1><div class=meta><div class=postdate>Updated <time datetime="2023-09-02 17:28:34 +0100 BST" itemprop=datePublished>2023-09-02</time>
<span class=commit-hash>(<a href=/log/index.html#d64c4a5>d64c4a5</a>)</span></div></div></header><div class=content itemprop=articleBody><p>For features $x_i={x_{i1},\dots,x_{ip}}$ and $x_j={x_{j1},\dots,x_{jp}}$, the Gower similarity matrix <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> can be defined as</p><p>$$
S_{\text{Gower}}(x_i, x_j) = \frac{\sum_{k=1}^p s_{ijk}\delta_{ijk}}{\sum_{k=1}^p \delta_{ijk}}.
$$</p><p>For each feature $k=1,\dots,p$ a score $s_{ijk}$ is calculated.
A quantity $\delta_{ijk}$ is also calculated having possible values ${0,1}$ depending on whether the variables $x_i$ and $x_j$ can be compared or not (/e.g./ if they have different types).</p><p>A special case<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> for when <em>no missing values exist</em> can be formulated as the mean of the Gower similarity scores, that is:</p><p>$$
S_{\text{Gower}}(x_i, x_j) = \frac{\sum_{k=1}^p s_{ijk}}{p}.
$$</p><p>The score $s_{ijk}$ calculation will depend on the type of variable and below we will see some examples.</p><p>This similarity score will take values between $0 \leq s_{ijk} \leq 1$ with $0$ representing maximum similarity and $1$ no similarity.</p><h2 id=scoring x-intersect="currentHeading = '#scoring'">Scoring</h2><h3 id=numerical-variables x-intersect="currentHeading = '#numerical-variables'">Numerical variables</h3><p>For numerical variables the score can be calculated as</p><p>$$
s_{ijk} = 1 - \frac{|x_{ik}-x_{jk}|}{R_k}.
$$</p><p>This is simply a <a href=/distance-metrics.html#manhattan-distance-l1>L1</a> distance between the two values normalised by a quantity $R_k$.
The quantity $R_k$ refers to the range of feature (population /or/ sample).</p><h3 id=categorical-variables x-intersect="currentHeading = '#categorical-variables'">Categorical variables</h3><p>For categorical variables we will use following score:</p><p>$$
s_{ijk} = 1{x_{ik}=x_{jk}}
$$</p><p>This score will be $1$ if the categories are the same and $0$ if they are not.</p><p>In reality the score $S_{\text{Gower}}(x_i, x_j)$ will be a /similarity score/ taking values between $1$ (for equal points) and $0$ for extremely dissimilar points.
In order to turn this value into a /distance metric/ we can convert it using (for instance)</p><p>$$
d_{\text{Gower}} = \sqrt{1-S_{\text{Gower}}}.
$$</p><p>This will take values of $1$ for the furthest points and $0$ for the same points.</p><h2 id=example x-intersect="currentHeading = '#example'">Example</h2><p>Here we will use the special case when no missing values exist. A test dataset can be:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>import</span> <span style=color:#555>pandas</span> <span style=font-weight:700>as</span> <span style=color:#555>pd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=font-weight:700>=</span> pd<span style=font-weight:700>.</span>DataFrame({
</span></span><span style=display:flex><span>    <span style=color:#b84>&#34;Sex1&#34;</span>: [<span style=color:#b84>&#39;M&#39;</span>, <span style=color:#b84>&#39;M&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;M&#39;</span>, <span style=color:#b84>&#39;M&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>],
</span></span><span style=display:flex><span>    <span style=color:#b84>&#34;Sex2&#34;</span>: [<span style=color:#b84>&#39;M&#39;</span>, <span style=color:#b84>&#39;M&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;F&#39;</span>, <span style=color:#b84>&#39;M&#39;</span>, <span style=color:#b84>&#39;M&#39;</span>, <span style=color:#b84>&#39;M&#39;</span>],
</span></span><span style=display:flex><span>    <span style=color:#b84>&#34;Age1&#34;</span>: [<span style=color:#099>15</span>, <span style=color:#099>15</span>, <span style=color:#099>15</span>, <span style=color:#099>15</span>, <span style=color:#099>15</span>, <span style=color:#099>15</span>, <span style=color:#099>15</span>, <span style=color:#099>15</span>, <span style=color:#099>15</span>, <span style=color:#099>15</span>],
</span></span><span style=display:flex><span>    <span style=color:#b84>&#34;Age2&#34;</span>: [<span style=color:#099>15</span>, <span style=color:#099>36</span>, <span style=color:#099>58</span>, <span style=color:#099>78</span>, <span style=color:#099>100</span>, <span style=color:#099>15</span>, <span style=color:#099>36</span>, <span style=color:#099>58</span>, <span style=color:#099>78</span>, <span style=color:#099>100</span>]
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>df
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>Sex1</th><th>Sex2</th><th>Age1</th><th>Age2</th></tr></thead><tbody><tr><th>0</th><td>M</td><td>M</td><td>15</td><td>15</td></tr><tr><th>1</th><td>M</td><td>M</td><td>15</td><td>36</td></tr><tr><th>2</th><td>F</td><td>F</td><td>15</td><td>58</td></tr><tr><th>3</th><td>F</td><td>F</td><td>15</td><td>78</td></tr><tr><th>4</th><td>F</td><td>F</td><td>15</td><td>100</td></tr><tr><th>5</th><td>M</td><td>F</td><td>15</td><td>15</td></tr><tr><th>6</th><td>M</td><td>F</td><td>15</td><td>36</td></tr><tr><th>7</th><td>F</td><td>M</td><td>15</td><td>58</td></tr><tr><th>8</th><td>F</td><td>M</td><td>15</td><td>78</td></tr><tr><th>9</th><td>F</td><td>M</td><td>15</td><td>100</td></tr></tbody></table></div><p>For the numerical variable (age) we can define the range as $R_{\text{age}}=\left(\max{\text{age}}-\min{\text{age}}\right)$.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>_fields <span style=font-weight:700>=</span> [<span style=color:#b84>&#34;Age1&#34;</span>, <span style=color:#b84>&#34;Age2&#34;</span>]
</span></span><span style=display:flex><span>age_min <span style=font-weight:700>=</span> df[_fields]<span style=font-weight:700>.</span>min()<span style=font-weight:700>.</span>min()
</span></span><span style=display:flex><span>age_max <span style=font-weight:700>=</span> df[_fields]<span style=font-weight:700>.</span>max()<span style=font-weight:700>.</span>max()
</span></span><span style=display:flex><span>R_age <span style=font-weight:700>=</span> age_max <span style=font-weight:700>-</span> age_min
</span></span></code></pre></div><p>We can now calculate the score for each numerical field</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>s_numeric</span>(x1, x2, R):
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> <span style=color:#099>1</span> <span style=font-weight:700>-</span> <span style=color:#999>abs</span>(x1<span style=font-weight:700>-</span>x2)<span style=font-weight:700>/</span>R
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df[<span style=color:#b84>&#39;s_age&#39;</span>] <span style=font-weight:700>=</span> df<span style=font-weight:700>.</span>apply(<span style=font-weight:700>lambda</span> x: s_numeric(x[<span style=color:#b84>&#39;Age1&#39;</span>], x[<span style=color:#b84>&#39;Age2&#39;</span>], R_age), axis<span style=font-weight:700>=</span><span style=color:#099>1</span>)
</span></span><span style=display:flex><span>df
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>Sex1</th><th>Sex2</th><th>Age1</th><th>Age2</th><th>s_age</th></tr></thead><tbody><tr><th>0</th><td>M</td><td>M</td><td>15</td><td>15</td><td>1.000000</td></tr><tr><th>1</th><td>M</td><td>M</td><td>15</td><td>36</td><td>0.752941</td></tr><tr><th>2</th><td>F</td><td>F</td><td>15</td><td>58</td><td>0.494118</td></tr><tr><th>3</th><td>F</td><td>F</td><td>15</td><td>78</td><td>0.258824</td></tr><tr><th>4</th><td>F</td><td>F</td><td>15</td><td>100</td><td>0.000000</td></tr><tr><th>5</th><td>M</td><td>F</td><td>15</td><td>15</td><td>1.000000</td></tr><tr><th>6</th><td>M</td><td>F</td><td>15</td><td>36</td><td>0.752941</td></tr><tr><th>7</th><td>F</td><td>M</td><td>15</td><td>58</td><td>0.494118</td></tr><tr><th>8</th><td>F</td><td>M</td><td>15</td><td>78</td><td>0.258824</td></tr><tr><th>9</th><td>F</td><td>M</td><td>15</td><td>100</td><td>0.000000</td></tr></tbody></table></div><p>For categorical variables we can define the following score function:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>s_categorical</span>(x1, x2):
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> <span style=color:#099>1</span> <span style=font-weight:700>if</span> x1<span style=font-weight:700>==</span>x2 <span style=font-weight:700>else</span> <span style=color:#099>0</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df[<span style=color:#b84>&#39;s_sex&#39;</span>] <span style=font-weight:700>=</span> df<span style=font-weight:700>.</span>apply(<span style=font-weight:700>lambda</span> x: s_categorical(x[<span style=color:#b84>&#39;Sex1&#39;</span>], x[<span style=color:#b84>&#39;Sex2&#39;</span>]), axis<span style=font-weight:700>=</span><span style=color:#099>1</span>)
</span></span><span style=display:flex><span>df
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>Sex1</th><th>Sex2</th><th>Age1</th><th>Age2</th><th>s_age</th><th>s_sex</th></tr></thead><tbody><tr><th>0</th><td>M</td><td>M</td><td>15</td><td>15</td><td>1.000000</td><td>1</td></tr><tr><th>1</th><td>M</td><td>M</td><td>15</td><td>36</td><td>0.752941</td><td>1</td></tr><tr><th>2</th><td>F</td><td>F</td><td>15</td><td>58</td><td>0.494118</td><td>1</td></tr><tr><th>3</th><td>F</td><td>F</td><td>15</td><td>78</td><td>0.258824</td><td>1</td></tr><tr><th>4</th><td>F</td><td>F</td><td>15</td><td>100</td><td>0.000000</td><td>1</td></tr><tr><th>5</th><td>M</td><td>F</td><td>15</td><td>15</td><td>1.000000</td><td>0</td></tr><tr><th>6</th><td>M</td><td>F</td><td>15</td><td>36</td><td>0.752941</td><td>0</td></tr><tr><th>7</th><td>F</td><td>M</td><td>15</td><td>58</td><td>0.494118</td><td>0</td></tr><tr><th>8</th><td>F</td><td>M</td><td>15</td><td>78</td><td>0.258824</td><td>0</td></tr><tr><th>9</th><td>F</td><td>M</td><td>15</td><td>100</td><td>0.000000</td><td>0</td></tr></tbody></table></div><p>We can now calculate the final score using</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>import</span> <span style=color:#555>math</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df[<span style=color:#b84>&#39;s&#39;</span>] <span style=font-weight:700>=</span> df<span style=font-weight:700>.</span>apply(<span style=font-weight:700>lambda</span> x: (x[<span style=color:#b84>&#39;s_age&#39;</span>] <span style=font-weight:700>+</span> x[<span style=color:#b84>&#39;s_sex&#39;</span>])<span style=font-weight:700>/</span><span style=color:#099>2.0</span>, axis<span style=font-weight:700>=</span><span style=color:#099>1</span>)
</span></span><span style=display:flex><span>df[<span style=color:#b84>&#39;d&#39;</span>] <span style=font-weight:700>=</span> df<span style=font-weight:700>.</span>apply(<span style=font-weight:700>lambda</span> x: math<span style=font-weight:700>.</span>sqrt(<span style=color:#099>1.0</span> <span style=font-weight:700>-</span> x[<span style=color:#b84>&#39;s&#39;</span>]), axis<span style=font-weight:700>=</span><span style=color:#099>1</span>)
</span></span><span style=display:flex><span>df
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>Sex1</th><th>Sex2</th><th>Age1</th><th>Age2</th><th>s_age</th><th>s_sex</th><th>s</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>M</td><td>M</td><td>15</td><td>15</td><td>1.000000</td><td>1</td><td>1.000000</td><td>0.000000</td></tr><tr><th>1</th><td>M</td><td>M</td><td>15</td><td>36</td><td>0.752941</td><td>1</td><td>0.876471</td><td>0.351468</td></tr><tr><th>2</th><td>F</td><td>F</td><td>15</td><td>58</td><td>0.494118</td><td>1</td><td>0.747059</td><td>0.502933</td></tr><tr><th>3</th><td>F</td><td>F</td><td>15</td><td>78</td><td>0.258824</td><td>1</td><td>0.629412</td><td>0.608760</td></tr><tr><th>4</th><td>F</td><td>F</td><td>15</td><td>100</td><td>0.000000</td><td>1</td><td>0.500000</td><td>0.707107</td></tr><tr><th>5</th><td>M</td><td>F</td><td>15</td><td>15</td><td>1.000000</td><td>0</td><td>0.500000</td><td>0.707107</td></tr><tr><th>6</th><td>M</td><td>F</td><td>15</td><td>36</td><td>0.752941</td><td>0</td><td>0.376471</td><td>0.789639</td></tr><tr><th>7</th><td>F</td><td>M</td><td>15</td><td>58</td><td>0.494118</td><td>0</td><td>0.247059</td><td>0.867722</td></tr><tr><th>8</th><td>F</td><td>M</td><td>15</td><td>78</td><td>0.258824</td><td>0</td><td>0.129412</td><td>0.933053</td></tr><tr><th>9</th><td>F</td><td>M</td><td>15</td><td>100</td><td>0.000000</td><td>0</td><td>0.000000</td><td>1.000000</td></tr></tbody></table></div><h2 id=range-impact x-intersect="currentHeading = '#range-impact'">Range impact</h2><h3 id=varying-bounds x-intersect="currentHeading = '#varying-bounds'">Varying bounds</h3><p>Let&rsquo;s visualise how the choice of range can affect the scoring, if can set it arbitrarily.
First let&rsquo;s pick two random points, $x_1=(30, M)$ and $x_2=(35, F)$.</p><p>We will vary the bounds from a $15\leq x_{min}&lt;30$ and $35&lt; x_{max} \leq 100$.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>score</span>(x1, x2, R):
</span></span><span style=display:flex><span>    s_0 <span style=font-weight:700>=</span> <span style=color:#099>1</span><span style=font-weight:700>-</span><span style=color:#999>abs</span>(x1[<span style=color:#099>0</span>]<span style=font-weight:700>-</span>x2[<span style=color:#099>0</span>])<span style=font-weight:700>/</span>R
</span></span><span style=display:flex><span>    s_1 <span style=font-weight:700>=</span> <span style=color:#099>1</span> <span style=font-weight:700>if</span> x1[<span style=color:#099>1</span>]<span style=font-weight:700>==</span>x2[<span style=color:#099>1</span>] <span style=font-weight:700>else</span> <span style=color:#099>0</span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> (s_0 <span style=font-weight:700>+</span> s_1)<span style=font-weight:700>/</span><span style=color:#099>2.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>distance</span>(s):
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> math<span style=font-weight:700>.</span>sqrt(<span style=color:#099>1.0</span><span style=font-weight:700>-</span>s)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>import</span> <span style=color:#555>numpy</span> <span style=font-weight:700>as</span> <span style=color:#555>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>x1 <span style=font-weight:700>=</span> (<span style=color:#099>30</span>, <span style=color:#b84>&#39;M&#39;</span>)
</span></span><span style=display:flex><span>x2 <span style=font-weight:700>=</span> (<span style=color:#099>35</span>, <span style=color:#b84>&#39;F&#39;</span>)
</span></span><span style=display:flex><span>bmin <span style=font-weight:700>=</span> np<span style=font-weight:700>.</span>linspace(<span style=color:#099>15</span>, <span style=color:#099>30</span>, num<span style=font-weight:700>=</span><span style=color:#099>1000</span>)
</span></span><span style=display:flex><span>bmax <span style=font-weight:700>=</span> np<span style=font-weight:700>.</span>linspace(<span style=color:#099>36</span>, <span style=color:#099>100</span>, num<span style=font-weight:700>=</span><span style=color:#099>1000</span>)
</span></span><span style=display:flex><span>scores_min <span style=font-weight:700>=</span> [distance(score(x1, x2, <span style=color:#099>100</span><span style=font-weight:700>-</span>bm)) <span style=font-weight:700>for</span> bm <span style=font-weight:700>in</span> bmin]
</span></span><span style=display:flex><span>scores_max <span style=font-weight:700>=</span> [distance(score(x1, x2, bm<span style=font-weight:700>-</span><span style=color:#099>15</span>)) <span style=font-weight:700>for</span> bm <span style=font-weight:700>in</span> bmax]
</span></span></code></pre></div><p><img src=/Gower%20distance_files/figure-gfm/cell-11-output-1.png alt loading=lazy></p><p>Let&rsquo;s try with more separated points</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>x1 <span style=font-weight:700>=</span> (<span style=color:#099>16</span>, <span style=color:#b84>&#39;M&#39;</span>)
</span></span><span style=display:flex><span>x2 <span style=font-weight:700>=</span> (<span style=color:#099>90</span>, <span style=color:#b84>&#39;F&#39;</span>)
</span></span><span style=display:flex><span>bmin <span style=font-weight:700>=</span> np<span style=font-weight:700>.</span>linspace(<span style=color:#099>15</span>, <span style=color:#099>16</span>, num<span style=font-weight:700>=</span><span style=color:#099>1000</span>, endpoint<span style=font-weight:700>=</span><span style=font-weight:700>False</span>)
</span></span><span style=display:flex><span>bmax <span style=font-weight:700>=</span> np<span style=font-weight:700>.</span>linspace(<span style=color:#099>91</span>, <span style=color:#099>100</span>, num<span style=font-weight:700>=</span><span style=color:#099>1000</span>)
</span></span><span style=display:flex><span>scores_min <span style=font-weight:700>=</span> [distance(score(x1, x2, <span style=color:#099>100</span><span style=font-weight:700>-</span>bm)) <span style=font-weight:700>for</span> bm <span style=font-weight:700>in</span> bmin]
</span></span><span style=display:flex><span>scores_max <span style=font-weight:700>=</span> [distance(score(x1, x2, bm<span style=font-weight:700>-</span><span style=color:#099>16</span>)) <span style=font-weight:700>for</span> bm <span style=font-weight:700>in</span> bmax]
</span></span></code></pre></div><p><img src=/Gower%20distance_files/figure-gfm/cell-13-output-1.png alt loading=lazy></p><h3 id=varying-range-directly x-intersect="currentHeading = '#varying-range-directly'">Varying range directly</h3><p>We will now try to see how the distance between two point comparisons (very close, very far) changes when varying the range directly.
We will choose two sets of points, $x_1=(1000, M), x_2=(1001, F)$ and $x_1=(500, M), x_2=(50000, F)$.
The range will vary between</p><p>$$
\max(x_1, x_2)-\min(x_1, x_2)&lt;R&lt;100000.
$$</p><p>We are also interested on the weight the categorical variable will have on the final distance with varying bounds, so we will also calculate them for an alternative $x_2&rsquo;=(1001, M)$ anf $x_2&rsquo;=(50000, M)$.</p><p>For the first set of points we will have:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>x1 <span style=font-weight:700>=</span> (<span style=color:#099>1000.0</span>, <span style=color:#b84>&#39;M&#39;</span>)
</span></span><span style=display:flex><span>x2 <span style=font-weight:700>=</span> (<span style=color:#099>1001.0</span>, <span style=color:#b84>&#39;F&#39;</span>)
</span></span><span style=display:flex><span>MAX_RANGE <span style=font-weight:700>=</span> <span style=color:#099>100000</span>
</span></span><span style=display:flex><span>R <span style=font-weight:700>=</span> np<span style=font-weight:700>.</span>linspace(<span style=color:#999>max</span>(x1[<span style=color:#099>0</span>], x2[<span style=color:#099>0</span>])<span style=font-weight:700>-</span><span style=color:#999>min</span>(x1[<span style=color:#099>0</span>], x2[<span style=color:#099>0</span>]), MAX_RANGE, num<span style=font-weight:700>=</span><span style=color:#099>100000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>distances_M <span style=font-weight:700>=</span> [distance(score(x1, x2, i)) <span style=font-weight:700>for</span> i <span style=font-weight:700>in</span> R]
</span></span><span style=display:flex><span>distances_F <span style=font-weight:700>=</span> [distance(score(x1, (x2[<span style=color:#099>0</span>], <span style=color:#b84>&#39;M&#39;</span>), i)) <span style=font-weight:700>for</span> i <span style=font-weight:700>in</span> R]
</span></span></code></pre></div><p><img src=/Gower%20distance_files/figure-gfm/cell-15-output-1.png alt loading=lazy></p><p>And for far away points we will have:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>x1 <span style=font-weight:700>=</span> (<span style=color:#099>500.0</span>, <span style=color:#b84>&#39;M&#39;</span>)
</span></span><span style=display:flex><span>x2 <span style=font-weight:700>=</span> (<span style=color:#099>50000.0</span>, <span style=color:#b84>&#39;F&#39;</span>)
</span></span><span style=display:flex><span>MAX_RANGE <span style=font-weight:700>=</span> <span style=color:#099>100000</span>
</span></span><span style=display:flex><span>R <span style=font-weight:700>=</span> np<span style=font-weight:700>.</span>linspace(<span style=color:#999>max</span>(x1[<span style=color:#099>0</span>], x2[<span style=color:#099>0</span>])<span style=font-weight:700>-</span><span style=color:#999>min</span>(x1[<span style=color:#099>0</span>], x2[<span style=color:#099>0</span>]), MAX_RANGE, num<span style=font-weight:700>=</span><span style=color:#099>100000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>distances_M <span style=font-weight:700>=</span> [distance(score(x1, x2, i)) <span style=font-weight:700>for</span> i <span style=font-weight:700>in</span> R]
</span></span><span style=display:flex><span>distances_F <span style=font-weight:700>=</span> [distance(score(x1, (x2[<span style=color:#099>0</span>], <span style=color:#b84>&#39;M&#39;</span>), i)) <span style=font-weight:700>for</span> i <span style=font-weight:700>in</span> R]
</span></span></code></pre></div><p><img src=/Gower%20distance_files/figure-gfm/cell-17-output-1.png alt loading=lazy></p><h2 id=categorical-impact x-intersect="currentHeading = '#categorical-impact'">Categorical impact</h2><p>Predictably, in the scenario where we calculate the mean of the Gower distances, for a point $x$ with $p$ features, $x=(x_{1},\dots,x_{p})$, the contribution to the final distance of a categorial variable will be either $0$ or $1/p$, regardless of the range.</p><h2 id=missing-range x-intersect="currentHeading = '#missing-range'">Missing range</h2><p>For the previous examples the range $R$ was available, but how to calculate the mixed distance when the numerical range is absent?</p><p>A possible way is to use scale each feature using <em>unit scaling</em>:</p><p>$$
f_u(x) = \frac{x}{||x||}
$$</p><p>We will visualise how a difference varying from $-1000 \leq \delta \leq 1000$ varies with the $f_u(\delta)$ transformation.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>f_unit</span>(x):
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> np<span style=font-weight:700>.</span>exp(x)<span style=font-weight:700>/</span>(np<span style=font-weight:700>.</span>exp(x)<span style=font-weight:700>+</span><span style=color:#099>1.0</span>)
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>ilogit</span>(eta):
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> <span style=color:#099>1.0</span> <span style=font-weight:700>-</span> <span style=color:#099>1.0</span><span style=font-weight:700>/</span>(np<span style=font-weight:700>.</span>exp(eta)<span style=font-weight:700>+</span><span style=color:#099>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>delta <span style=font-weight:700>=</span> np<span style=font-weight:700>.</span>linspace(<span style=font-weight:700>-</span><span style=color:#099>10</span>, <span style=color:#099>10</span>, num<span style=font-weight:700>=</span><span style=color:#099>20000</span>)
</span></span><span style=display:flex><span>transformed <span style=font-weight:700>=</span> [ilogit(<span style=color:#999>abs</span>(x)) <span style=font-weight:700>for</span> x <span style=font-weight:700>in</span> delta]
</span></span></code></pre></div><p><img src=/Gower%20distance_files/figure-gfm/cell-19-output-1.png alt loading=lazy></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>cite:gower1971general Gower, J. C. (1971). A general coefficient of similarity and some of its properties. Biometrics, (), 857&ndash;871.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>This is for instance the case we deal with in the <a href=/counterfactuals-with-constraint-solvers.html>Counterfactuals with Constraint Solvers</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=/draw/>Drawings</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#scoring>Scoring</a><ul><li><a href=#numerical-variables>Numerical variables</a></li><li><a href=#categorical-variables>Categorical variables</a></li></ul></li><li><a href=#example>Example</a></li><li><a href=#range-impact>Range impact</a><ul><li><a href=#varying-bounds>Varying bounds</a></li><li><a href=#varying-range-directly>Varying range directly</a></li></ul></li><li><a href=#categorical-impact>Categorical impact</a></li><li><a href=#missing-range>Missing range</a></li></ul></nav></div><div id=share-footer style=display:none></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 Rui Vieira</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=/draw/>Drawings</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/css/fa.min.css><script src=/js/jquery-3.6.0.min.js></script>
<script src=/js/mark.min.js></script>
<script src=/js/main.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>