<!doctype html><html lang=en-uk><head><script data-goatcounter=https://ruivieira-dev.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script src=https://unpkg.com/@alpinejs/intersect@3.x.x/dist/cdn.min.js></script>
<script src=https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js></script>
<script type=module src=/js/deeplinks/deeplinks.js></script>
<link rel=preload href=/lib/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/fonts/firacode/FiraCode-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/fonts/prociono/Prociono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=stylesheet href=/css/kbd.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Maven · Rui Vieira</title><link rel=canonical href=/maven.html><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Maven"><meta property="og:description" content="SummaryNotes on the Maven build system.
ModesDaemonThis build mode relies on the Maven daemon, itself inspired by the Gradle daemon:
The Maven Daemon process does not reload classes unless they are changed.
The daemon is called with mvnd instead of mvn, for instance
$ mvnd clean install The daemon uses multiple threads by default, with $N_{cores}-1$.
ArtifactsÜber JARsThere are many ways to build über JARs, but we will talk about two, maven-assembly-plugin and maven-shade-plugin."><meta property="og:type" content="article"><meta property="og:url" content="/maven.html"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2023-01-15T15:53:40+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Maven"><meta name=twitter:description content="SummaryNotes on the Maven build system.
ModesDaemonThis build mode relies on the Maven daemon, itself inspired by the Gradle daemon:
The Maven Daemon process does not reload classes unless they are changed.
The daemon is called with mvnd instead of mvn, for instance
$ mvnd clean install The daemon uses multiple threads by default, with $N_{cores}-1$.
ArtifactsÜber JARsThere are many ways to build über JARs, but we will talk about two, maven-assembly-plugin and maven-shade-plugin."><link rel=stylesheet href=/css/styles.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=images/favicon.ico></head><body class="max-width mx-auto px3 ltr" x-data="{currentHeading: undefined}"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-eye fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-eye fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li></ul></span><br><div id=share style=display:none></div><div id=toc><h4>Contents</h4><nav id=TableOfContents><ul><li><a href=#summary :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#summary' }">Summary</a></li><li><a href=#modes :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#modes' }">Modes</a></li><li><a href=#daemon :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#daemon' }">Daemon</a></li><li><a href=#artifacts :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#artifacts' }">Artifacts</a></li><li><a href=#%c3%bcber-jars :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#über-jars' }">Über JARs</a></li><li><a href=#assembly :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#assembly' }">Assembly</a></li><li><a href=#shade :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#shade' }">Shade</a></li><li><a href=#dependencies :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#dependencies' }">Dependencies</a></li><li><a href=#tree :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#tree' }">Tree</a></li><li><a href=#testing :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#testing' }">Testing</a></li><li><a href=#excluding-tests :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#excluding-tests' }">Excluding tests</a></li></ul></nav><h4>Related</h4><nav><ul><li class="header-post toc"><span class=backlink-count>1</span>
<a href=/mcmc-performance-on-substrate-vm.html>MCMC performance on substrate VM</a></li><li class="header-post toc"><span class=backlink-count>1</span>
<a href=/java.html>Java</a></li><li class="header-post toc"><span class=backlink-count>1</span>
<a href=/java-build-systems.html>Java build systems</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Maven</h1><div class=meta><div class=postdate>Updated <time datetime="2023-01-15 15:53:40 +0000 GMT" itemprop=datePublished>2023-01-15</time>
<span class=commit-hash>(<a href=/log/index.html#fe73f60>fe73f60</a>)</span></div></div></header><div class=content itemprop=articleBody><h2 id=summary x-intersect="currentHeading = '#summary'">Summary</h2><p>Notes on the <a href=https://maven.apache.org/>Maven build system</a>.</p><h2 id=modes x-intersect="currentHeading = '#modes'">Modes</h2><h3 id=daemon x-intersect="currentHeading = '#daemon'">Daemon</h3><p>This build mode relies on the <a href=https://github.com/mvndaemon/mvnd>Maven daemon</a>, itself inspired by the <a href=https://docs.gradle.org/current/userguide/gradle_daemon.html>Gradle daemon</a>:</p><p>The Maven Daemon process does not reload classes unless they are changed.</p><p>The daemon is called with <code>mvnd</code> instead of <code>mvn</code>, for instance</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mvnd clean install
</span></span></code></pre></div><p>The daemon uses multiple threads by default, with $N_{cores}-1$.</p><h2 id=artifacts x-intersect="currentHeading = '#artifacts'">Artifacts</h2><h3 id=über-jars x-intersect="currentHeading = '#über-jars'">Über JARs</h3><p>There are many ways to build über JARs, but we will talk about two, <code>maven-assembly-plugin</code> and <code>maven-shade-plugin</code>.</p><h3 id=assembly x-intersect="currentHeading = '#assembly'">Assembly</h3><p>The <code>maven-assembly-plugin</code> <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> adds all dependencies inside the final fat JAR and can be used by adding the following to your <code>pom.xml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:navy>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:navy>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;artifactId&gt;</span>maven-assembly-plugin<span style=color:navy>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;descriptorRefs&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;descriptorRef&gt;</span>jar-with-dependencies<span style=color:navy>&lt;/descriptorRef&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/descriptorRefs&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;archive&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;manifest&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;mainClass&gt;</span>{your.package.main.class}<span style=color:navy>&lt;/mainClass&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;/manifest&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/archive&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;executions&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;execution&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;phase&gt;</span>package<span style=color:navy>&lt;/phase&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;goals&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;goal&gt;</span>single<span style=color:navy>&lt;/goal&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;/goals&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/execution&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/executions&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>Maven plugins should be specified inside a <code>&lt;plugins>&lt;/plugins></code> scope, which itself must be inside <code>&lt;build>&lt;/build></code> scope.
As you can see from execution <code>phase</code>, the Über JAR is built when calling <code>mvn package</code>.</p><h3 id=shade x-intersect="currentHeading = '#shade'">Shade</h3><p>The <code>maven-shade-plugin</code> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> also adds all dependencies inside the final fat JAR, but additionally executes shading.
Add the following to your <code>pom.xml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:navy>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:navy>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;artifactId&gt;</span>maven-shade-plugin<span style=color:navy>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;transformers&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;transformer</span> <span style=color:teal>implementation=</span><span style=color:#b84>&#34;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;mainClass&gt;</span>{your.package.main.class}<span style=color:navy>&lt;/mainClass&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;/transformer&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/transformers&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;executions&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;execution&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;phase&gt;</span>package<span style=color:navy>&lt;/phase&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;goals&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:navy>&lt;goal&gt;</span>shade<span style=color:navy>&lt;/goal&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:navy>&lt;/goals&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:navy>&lt;/execution&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/executions&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>The shade plugin also allows to specify dependency inclusion/exclusion using a variety of specifiers. The following example from the official docs<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> illustrates this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:navy>&lt;project&gt;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:navy>&lt;build&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:navy>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;artifactId&gt;</span>maven-shade-plugin<span style=color:navy>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;version&gt;</span>3.3.0<span style=color:navy>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;executions&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;execution&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:navy>&lt;phase&gt;</span>package<span style=color:navy>&lt;/phase&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:navy>&lt;goals&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;goal&gt;</span>shade<span style=color:navy>&lt;/goal&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:navy>&lt;/goals&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:navy>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;artifactSet&gt;</span>
</span></span><span style=display:flex><span>			  <span style=color:navy>&lt;excludes&gt;</span>                    
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;exclude&gt;</span>classworlds:classworlds<span style=color:navy>&lt;/exclude&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;exclude&gt;</span>junit:junit<span style=color:navy>&lt;/exclude&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;exclude&gt;</span>jmock:*<span style=color:navy>&lt;/exclude&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;exclude&gt;</span>*:xml-apis<span style=color:navy>&lt;/exclude&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;exclude&gt;</span>org.apache.maven:lib:tests<span style=color:navy>&lt;/exclude&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:navy>&lt;exclude&gt;</span>log4j:log4j:jar:<span style=color:navy>&lt;/exclude&gt;</span>
</span></span><span style=display:flex><span>			  <span style=color:navy>&lt;/excludes&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:navy>&lt;/artifactSet&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:navy>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;/execution&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;/executions&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/plugins&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/build&gt;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:navy>&lt;/project&gt;</span>
</span></span></code></pre></div><h2 id=dependencies x-intersect="currentHeading = '#dependencies'">Dependencies</h2><h3 id=tree x-intersect="currentHeading = '#tree'">Tree</h3><p>The <code>dependency-tree</code> plugin<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> allows to display a project&rsquo;s dependency tree.
At it&rsquo;s simplest running <code>mvn dependency:tree</code> will print a tree with the project&rsquo;s depency hierarchy.</p><h2 id=testing x-intersect="currentHeading = '#testing'">Testing</h2><h3 id=excluding-tests x-intersect="currentHeading = '#excluding-tests'">Excluding tests</h3><p>To exclude test from Maven use the following notation<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#998;font-style:italic># Exclude specific class with (!)</span>
</span></span><span style=display:flex><span>$ mvn <span style=color:#999>test</span> -Dtest<span style=font-weight:700>=</span>!ExcludedClass
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Exclude specific method </span>
</span></span><span style=display:flex><span>$ mvn <span style=color:#999>test</span> -Dtest<span style=font-weight:700>=</span>!ExcludedClass#excludedMethod
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Exclude more than one method</span>
</span></span><span style=display:flex><span>$ mvn <span style=color:#999>test</span> -Dtest<span style=font-weight:700>=</span>!ExcludedClass#excludedMethod+excludedMethod2
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Exclude a package with a wildcard (*)</span>
</span></span><span style=display:flex><span>$ mvn <span style=color:#999>test</span> -Dtest<span style=font-weight:700>=</span>!dev.ruivieira.test.Excluded*
</span></span></code></pre></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://maven.apache.org/plugins/maven-assembly-plugin/>https://maven.apache.org/plugins/maven-assembly-plugin/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://maven.apache.org/plugins/maven-shade-plugin/>https://maven.apache.org/plugins/maven-shade-plugin/</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://maven.apache.org/plugins/maven-shade-plugin/examples/includes-excludes.html>https://maven.apache.org/plugins/maven-shade-plugin/examples/includes-excludes.html</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://maven.apache.org/plugins/maven-dependency-plugin/tree-mojo.html>https://maven.apache.org/plugins/maven-dependency-plugin/tree-mojo.html</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>If using <a href=/zsh.html>zsh</a> remember to escape <code>!</code>.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#summary>Summary</a></li><li><a href=#modes>Modes</a><ul><li><a href=#daemon>Daemon</a></li></ul></li><li><a href=#artifacts>Artifacts</a><ul><li><a href=#über-jars>Über JARs</a></li><li><a href=#assembly>Assembly</a></li><li><a href=#shade>Shade</a></li></ul></li><li><a href=#dependencies>Dependencies</a><ul><li><a href=#tree>Tree</a></li></ul></li><li><a href=#testing>Testing</a><ul><li><a href=#excluding-tests>Excluding tests</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 Rui Vieira</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/css/fa.min.css><script src=/js/jquery-3.6.0.min.js></script>
<script src=/js/mark.min.js></script>
<script src=/js/main.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>