<!doctype html><html lang=en-uk><head><script data-goatcounter=https://ruivieira-dev.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script src=https://unpkg.com/@alpinejs/intersect@3.x.x/dist/cdn.min.js></script><script src=https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js></script><script type=module src=https://ruivieira.dev/js/deeplinks/deeplinks.js></script><link rel=preload href=https://ruivieira.dev/lib/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://ruivieira.dev/lib/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://ruivieira.dev/lib/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://ruivieira.dev/fonts/firacode/FiraCode-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://ruivieira.dev/fonts/vollkorn/Vollkorn-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=stylesheet href=https://ruivieira.dev/css/kbd.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>KServe Â· Rui Vieira</title>
<link rel=canonical href=https://ruivieira.dev/posts/kserve.html><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="KServe"><meta property="og:description" content="Logging Kserve logging TroubleshootingThe Impact of Low inotify WatchesWhen deploying KServe on Kubernetes, you might encounter a snag that leaves you scratching your head. A common yet perplexing issue arises with the following error messages:
...failed to get informer from cache... ...error retrieving resource lock... ...leader election lost... ...unable to run the manager... Among these, a particularly notable message is the system-level error too many open files. This is an indicator of a broader issue related to the number of inotify watches available on your system."><meta property="og:type" content="article"><meta property="og:url" content="https://ruivieira.dev/posts/kserve.html"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2024-02-10T16:17:19+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="KServe"><meta name=twitter:description content="Logging Kserve logging TroubleshootingThe Impact of Low inotify WatchesWhen deploying KServe on Kubernetes, you might encounter a snag that leaves you scratching your head. A common yet perplexing issue arises with the following error messages:
...failed to get informer from cache... ...error retrieving resource lock... ...leader election lost... ...unable to run the manager... Among these, a particularly notable message is the system-level error too many open files. This is an indicator of a broader issue related to the number of inotify watches available on your system."><link rel=stylesheet href=https://ruivieira.dev/css/styles.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://ruivieira.dev/images/favicon.ico></head><body class="max-width mx-auto px3 ltr" x-data="{currentHeading: undefined}"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-eye fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-eye fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=https://ruivieira.dev/>Home</a></li><li><a href=https://ruivieira.dev/blog/>Blog</a></li><li><a href=https://ruivieira.dev/draw/>Drawings</a></li><li><a href=https://ruivieira.dev/map/>All pages</a></li><li><a href=https://ruivieira.dev/search.html>Search</a></li></ul></span><br><div id=share style=display:none></div><div id=toc><h4>Contents</h4><nav id=TableOfContents><ul><li><a href=#logging :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#logging' }">Logging</a></li><li><a href=#troubleshooting :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#troubleshooting' }">Troubleshooting</a></li><li><a href=#the-impact-of-low-inotify-watches :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#the-impact-of-low-inotify-watches' }">The Impact of Low inotify Watches</a></li><li><a href=#the-culprit-low-inotify-watches :class="{'toc-h4':true, 'toc-highlight': currentHeading == '#the-culprit-low-inotify-watches' }">The Culprit: Low inotify Watches</a></li><li><a href=#the-solution-increase-the-limit :class="{'toc-h4':true, 'toc-highlight': currentHeading == '#the-solution-increase-the-limit' }">The Solution: Increase the Limit</a></li></ul></nav><h4>Related</h4><nav><ul><li class="header-post toc"><span class=backlink-count>1</span>
<a href=https://ruivieira.dev/model-serving.html>Model serving</a></li><li class="header-post toc"><span class=backlink-count>1</span>
<a href=https://ruivieira.dev/machine-learning.html>Machine Learning</a></li><li class="header-post toc"><span class=backlink-count>1</span>
<a href=https://ruivieira.dev/blog/2024-02-23.html>2024_02_23</a></li><li class="header-post toc"><span class=backlink-count>1</span>
<a href=https://ruivieira.dev/blog/2023-09-07.html>2023_09_07</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">KServe</h1><div class=meta><div class=postdate>Updated <time datetime="2024-02-10 16:17:19 +0000 GMT" itemprop=datePublished>2024-02-10</time>
<span class=commit-hash>(<a href=https://ruivieira.dev/log/index.html#e4a50cc>e4a50cc</a>)</span></div></div></header><div class=content itemprop=articleBody><figure><img src=https://ruivieira.dev/assets/kserve.jpg alt=kserve.jpg loading=lazy></figure><h2 id=logging x-intersect="currentHeading = '#logging'">Logging</h2><ul><li><a href=https://ruivieira.dev/blog/2023-09-27.html>Kserve logging</a></li></ul><h2 id=troubleshooting x-intersect="currentHeading = '#troubleshooting'">Troubleshooting</h2><h3 id=the-impact-of-low-inotify-watches x-intersect="currentHeading = '#the-impact-of-low-inotify-watches'">The Impact of Low inotify Watches</h3><p>When deploying KServe on <a href=https://ruivieira.dev/kubernetes.html>Kubernetes</a>, you might encounter a snag that leaves you scratching your head. A common yet perplexing issue arises with the following error messages:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>...failed to get informer from cache...
</span></span><span style=display:flex><span>...error retrieving resource lock...
</span></span><span style=display:flex><span>...leader election lost...
</span></span><span style=display:flex><span>...unable to run the manager...
</span></span></code></pre></div><p>Among these, a particularly notable message is the system-level error <code>too many open files</code>. This is an indicator of a broader issue related to the number of inotify watches available on your system.</p><h4 id=the-culprit-low-inotify-watches x-intersect="currentHeading = '#the-culprit-low-inotify-watches'">The Culprit: Low inotify Watches</h4><p>Inotify watches are crucial for monitoring file system events. When running Kubernetes clusters, and specifically with tools like KServe, each watch becomes a valuable resource due to the multitude of file-related operations. When the limit is too low, you&rsquo;re bound to hit a wall, as the system can&rsquo;t keep an eye on all the necessary files, leading to the dreaded errors mentioned above.</p><p>This problem is known to manifest more frequently when using Kubernetes IN Docker (KinD), as many users have discovered. KinD is an excellent tool for local Kubernetes testing, but it does come with its own set of quirks, as documented in their <a href=https://kind.sigs.k8s.io/docs/user/known-issues/#pod-errors-due-to-too-many-open-files>known issues</a> section.</p><h4 id=the-solution-increase-the-limit x-intersect="currentHeading = '#the-solution-increase-the-limit'">The Solution: Increase the Limit</h4><p>Thankfully, the fix is straightforward. The KinD documentation provides a solution that involves increasing the number of allowable inotify watches. For systems using sysctl, the command would be:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sysctl fs.inotify.max_user_watches<span style=font-weight:700>=</span><span style=color:#099>524288</span>
</span></span></code></pre></div><p>This command increases the limit significantly, allowing KServe and other Kubernetes resources to deploy without running into the &ldquo;too many open files&rdquo; error. For a permanent fix, you can also add <code>fs.inotify.max_user_watches=524288</code> to your sysctl configuration file (usually located at <code>/etc/sysctl.conf</code> or a file within <code>/etc/sysctl.d/</code>).</p><p>The deployment of KServe on Kubernetes can hit a roadblock if the system runs out of inotify watches. This is a known issue, especially on KinD clusters, but the solution is as simple as increasing the inotify watch limit. By doing so, you not only smooth out the deployment of KServe but also enhance the overall robustness of your local Kubernetes environment. Keep this tip in mind, and your path to deploying KServe should be clear and error-free.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=https://ruivieira.dev/>Home</a></li><li><a href=https://ruivieira.dev/blog/>Blog</a></li><li><a href=https://ruivieira.dev/draw/>Drawings</a></li><li><a href=https://ruivieira.dev/map/>All pages</a></li><li><a href=https://ruivieira.dev/search.html>Search</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#logging>Logging</a></li><li><a href=#troubleshooting>Troubleshooting</a><ul><li><a href=#the-impact-of-low-inotify-watches>The Impact of Low inotify Watches</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2024 Rui Vieira</div><div class=footer-right><nav><ul><li><a href=https://ruivieira.dev/>Home</a></li><li><a href=https://ruivieira.dev/blog/>Blog</a></li><li><a href=https://ruivieira.dev/draw/>Drawings</a></li><li><a href=https://ruivieira.dev/map/>All pages</a></li><li><a href=https://ruivieira.dev/search.html>Search</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=https://ruivieira.dev/css/fa.min.css><script src=https://ruivieira.dev/js/jquery-3.6.0.min.js></script><script src=https://ruivieira.dev/js/mark.min.js></script><script src=https://ruivieira.dev/js/main.js></script></html>