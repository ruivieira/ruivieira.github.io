<!doctype html><html lang=en-uk><head><script data-goatcounter=https://ruivieira-dev.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script src=https://unpkg.com/@alpinejs/intersect@3.x.x/dist/cdn.min.js></script>
<script src=https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js></script>
<script type=module src=/js/deeplinks/deeplinks.js></script>
<link rel=preload href=/lib/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/fonts/firacode/FiraCode-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/fonts/prociono/Prociono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=stylesheet href=/css/kbd.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>TrustyAI-KServe conversions Â· Rui Vieira</title><link rel=canonical href=/trustyai-kserve-conversions.html><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="TrustyAI-KServe conversions"><meta property="og:description" content="SynopsisInference data is represented in TrustyAI1 using objects implementing the Prediction interface. The objects always include two general entities representing collections of inputs (PredictionInput) and outputs (PredictionOutput). These in turn are comprised of Features and Outputs, respectively.
Communication with KServe/ModelMesh deployed models is done, however, using gRPC, with the KServe v2 protocol.
The basis of prediction requests is the KServe ModelInferenceRequest message, where model responses are based on the ModelInferenceResponse message."><meta property="og:type" content="article"><meta property="og:url" content="/trustyai-kserve-conversions.html"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2023-05-28T11:45:56+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="TrustyAI-KServe conversions"><meta name=twitter:description content="SynopsisInference data is represented in TrustyAI1 using objects implementing the Prediction interface. The objects always include two general entities representing collections of inputs (PredictionInput) and outputs (PredictionOutput). These in turn are comprised of Features and Outputs, respectively.
Communication with KServe/ModelMesh deployed models is done, however, using gRPC, with the KServe v2 protocol.
The basis of prediction requests is the KServe ModelInferenceRequest message, where model responses are based on the ModelInferenceResponse message."><link rel=stylesheet href=/css/styles.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=images/favicon.ico></head><body class="max-width mx-auto px3 ltr" x-data="{currentHeading: undefined}"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-eye fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-eye fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li><li><a href=/draw/>Drawings</a></li></ul></span><br><div id=share style=display:none></div><div id=toc><h4>Contents</h4><nav id=TableOfContents><ul><li><a href=#synopsis :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#synopsis' }">Synopsis</a></li><li><a href=#single-input :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#single-input' }">Single input</a></li><li><a href=#np-codec :class="{'toc-h4':true, 'toc-highlight': currentHeading == '#np-codec' }">np codec</a></li><li><a href=#pd-codec :class="{'toc-h4':true, 'toc-highlight': currentHeading == '#pd-codec' }">pd codec</a></li><li><a href=#outputs :class="{'toc-h4':true, 'toc-highlight': currentHeading == '#outputs' }">Outputs</a></li><li><a href=#multiple-inputs :class="{'toc-h3':true, 'toc-highlight': currentHeading == '#multiple-inputs' }">Multiple inputs</a></li><li><a href=#np-codec :class="{'toc-h4':true, 'toc-highlight': currentHeading == '#np-codec' }">np codec</a></li><li><a href=#pd-codec :class="{'toc-h4':true, 'toc-highlight': currentHeading == '#pd-codec' }">pd codec</a></li><li><a href=#outputs :class="{'toc-h4':true, 'toc-highlight': currentHeading == '#outputs' }">Outputs</a></li><li><a href=#dataframe-utilities :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#dataframe-utilities' }">Dataframe utilities</a></li><li><a href=#schemas :class="{'toc-h2':true, 'toc-highlight': currentHeading == '#schemas' }">Schemas</a></li></ul></nav></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">TrustyAI-KServe conversions</h1><div class=meta><div class=postdate>Updated <time datetime="2023-05-28 11:45:56 +0100 BST" itemprop=datePublished>2023-05-28</time>
<span class=commit-hash>(<a href=/log/index.html#1454e0a>1454e0a</a>)</span></div></div></header><div class=content itemprop=articleBody><h2 id=synopsis x-intersect="currentHeading = '#synopsis'">Synopsis</h2><p>Inference data is represented in TrustyAI<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> using objects implementing the <code>Prediction</code> interface.
The objects always include two general entities representing collections of inputs (<code>PredictionInput</code>) and outputs (<code>PredictionOutput</code>). These in turn are comprised of <code>Features</code> and <code>Outputs</code>, respectively.</p><figure><img src=/assets/TrustyAI%20predictions.excalidraw.svg alt="TrustyAI predictions.excalidraw.svg"></figure><p>Communication with KServe/ModelMesh deployed models is done, however, using gRPC, with the KServe v2 protocol.</p><figure><img src=/assets/TrustyAI%20KServe.excalidraw.svg alt="TrustyAI KServe.excalidraw.svg"></figure><p>The basis of prediction requests is the KServe <code>ModelInferenceRequest</code> message, where model responses are based on the <code>ModelInferenceResponse</code> message. Payloads (and data in general) are encoded as <code>InferInputTensor</code> and <code>InferResponseTensor</code>. Here we look at several scenarios to convert data to/from KServe tensors and TrustyAI <code>Predictions</code>.</p><h3 id=single-input x-intersect="currentHeading = '#single-input'">Single input</h3><h4 id=np-codec x-intersect="currentHeading = '#np-codec'">np codec</h4><p>Currently, the conversion between <code>PredictionInput</code> and <code>PredictionOutput</code> to KServe Tensor format works in the following way:
We assume a consistent datatype between the features and serialise it as a $(1, N_f)$ shaped tensor.</p><blockquote><p>Note that although a JSON representation of the data is used, it is only for illustration of the structure. The TrustyAI structures are converted to Protobuf format.</p></blockquote><figure><img src=/assets/KServe%20TrustyAI%20schema%201.excalidraw.svg alt="KServe TrustyAI schema 1.excalidraw.svg"></figure><p>This is using the default KServe conversion codec <code>np</code>.</p><h4 id=pd-codec x-intersect="currentHeading = '#pd-codec'">pd codec</h4><p>KServe also allows to use the <code>pd</code> conversion codec, where <em>each</em> feature is a $(1, 1)$ shaped Tensor.
This allows for greater flexibility, especially in the common case where each feature has a different datatype. In TrustyAI, this conversion works the following way:</p><figure><img src=/assets/KServe%20TrustyAI%20schema%202.excalidraw.svg alt="KServe TrustyAI schema 2.excalidraw.svg"></figure><h4 id=outputs x-intersect="currentHeading = '#outputs'">Outputs</h4><p>For the single input case, the output conversion is straightforward.
We get a $(1, N_f)$ shaped tensor for the outputs, which allows for direct conversion to a single <code>PredictionOutput</code>, such that</p><figure><img src=/assets/KServe%20TrustyAI%20schema%203.excalidraw.svg alt="KServe TrustyAI schema 3.excalidraw.svg"></figure><h3 id=multiple-inputs x-intersect="currentHeading = '#multiple-inputs'">Multiple inputs</h3><p>There are basically two ways of dealing with the multiple inputs, such as in the single inputs case. In this case we will consider $N_{obs}$ inputs, each with $N_f$ features.</p><h4 id=np-codec-1 x-intersect="currentHeading = '#np-codec-1'">np codec</h4><p>With the <code>np</code> codec, we simply produce a $(N_{obs}, N_f)$ shaped tensor, sharing the same datatype.</p><figure><img src=/assets/KServe%20TrustyAI%20schema%204.excalidraw.svg alt="KServe TrustyAI schema 4.excalidraw.svg"></figure><h4 id=pd-codec-1 x-intersect="currentHeading = '#pd-codec-1'">pd codec</h4><figure><img src=/assets/KServe%20TrustyAI%20schema%205.excalidraw.svg alt="KServe TrustyAI schema 5.excalidraw.svg"></figure><h4 id=outputs-1 x-intersect="currentHeading = '#outputs-1'">Outputs</h4><p>With multiple outputs come multiple outputs and here the situation is not as straightforward.
Let&rsquo;s assume that for the previous inputs we get two features as the inference result.
Usually, the outputs will come as a $(1, N_{obs}\times N_f)$ shaped tensor, so we will need to reshape it. So we&rsquo;ll have something like</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{ 
</span></span><span style=display:flex><span>	<span style=color:navy>&#34;model_name&#34;</span>: <span style=color:#b84>&#34;dummy3&#34;</span>, 
</span></span><span style=display:flex><span>	<span style=color:navy>&#34;model_version&#34;</span>: <span style=color:#b84>&#34;v0.0.1&#34;</span>, 
</span></span><span style=display:flex><span>	<span style=color:navy>&#34;id&#34;</span>: <span style=color:#b84>&#34;3aacc8a0-a3cc-47ce-bd03-614df833d18e&#34;</span>, 
</span></span><span style=display:flex><span>	<span style=color:navy>&#34;parameters&#34;</span>: {}, 
</span></span><span style=display:flex><span>	<span style=color:navy>&#34;outputs&#34;</span>: [ 
</span></span><span style=display:flex><span>		{ 
</span></span><span style=display:flex><span>			<span style=color:navy>&#34;name&#34;</span>: <span style=color:#b84>&#34;predict&#34;</span>, 
</span></span><span style=display:flex><span>			<span style=color:navy>&#34;shape&#34;</span>: [ <span style=color:#099>3</span>, <span style=color:#099>2</span> ], 
</span></span><span style=display:flex><span>			<span style=color:navy>&#34;datatype&#34;</span>: <span style=color:#b84>&#34;INT64&#34;</span>, 
</span></span><span style=display:flex><span>			<span style=color:navy>&#34;data&#34;</span>: [ <span style=color:#099>2</span>, <span style=color:#099>2</span>, <span style=color:#099>1</span>, <span style=color:#099>4</span>, <span style=color:#099>2</span>, <span style=color:#099>2</span> ] 
</span></span><span style=display:flex><span>		} 
</span></span><span style=display:flex><span>	] 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Since we know the final shape of the multiple outputs (with the <code>shape</code> value), we can reshape it using:<figure><img src=/assets/KServe%20TrustyAI%20schema%206.excalidraw.svg alt="KServe TrustyAI schema 6.excalidraw.svg"></figure></p><h2 id=dataframe-utilities x-intersect="currentHeading = '#dataframe-utilities'">Dataframe utilities</h2><p>A collection of <code>Prediction</code> can be also represented as a <code>Dataframe</code>.
Dataframe will represent the data in tabular format along with the necessary metadata related to the feature types, feature domains and if the feature belongs in the inputs or outputs.</p><p><figure><img src=/assets/TrustyAI%20dataframe.excalidraw.svg alt="TrustyAI dataframe.excalidraw.svg"></figure>A new data structure, called a <code>TensorDataframe</code> is an extension of the <code>Dataframe</code>, sharing a common API, but adding a few convenience methods to convert either individual rows (or the entire data) to tensors.
The first methods are</p><ul><li><code>.rowAsSingleArrayInputTensor()</code>, which converts a single row&rsquo;s inputs to the <code>np</code> tensor format</li><li><code>.rowAsSingleDataframeInputTensor()</code>, which converts a single row&rsquo;s inputs to the <code>pd</code> tensor format<figure><img src=/assets/TrustyAI%20dataframe%202.excalidraw.svg alt="TrustyAI dataframe 2.excalidraw.svg"></figure>If an entire dataset needs to be converted (say for batch requests), we can use:</li><li><code>.rowBatchArrayInputTensor()</code>, converts an entire dataframe to the <code>np</code> tensor format</li><li><code>rowBatchDataframeInputTensor()</code>, converts an entire dataframe to the <code>pd</code> tensor format<figure><img src=/assets/TrustyAI%20dataframe%203.excalidraw.svg alt="TrustyAI dataframe 3.excalidraw.svg"></figure></li></ul><h2 id=schemas x-intersect="currentHeading = '#schemas'">Schemas</h2><p>A table with the values of the schemas for each scenario.</p><table><thead><tr><th>Scenario</th><th>Format</th><th># Input features</th><th># Output features</th><th>Batch size</th><th>Top inputs count</th><th>Input(s) shape</th><th>Top output counts</th><th>Output(s) shape</th></tr></thead><tbody><tr><td>1 input, 1 output, no batch</td><td>NP</td><td>1</td><td>1</td><td>1</td><td>1</td><td>[0,1]</td><td>1</td><td>[0,1]</td></tr><tr><td>1 input, 2 outputs, no batch</td><td>NP</td><td>1</td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1,1]</td><td>1</td><td>[1,<strong>2</strong>]</td></tr><tr><td>2 inputs, 1 output, no batch</td><td>NP</td><td><strong>2</strong></td><td>1</td><td>1</td><td>1</td><td>[1,<strong>2</strong>]</td><td>1</td><td>[1,1]</td></tr><tr><td>2 inputs, 2 outputs, no batch</td><td>NP</td><td><strong>2</strong></td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1,<strong>2</strong>]</td><td>1</td><td>[1,<strong>2</strong>]</td></tr><tr><td>1 input, 1 output, no batch</td><td>PD</td><td>1</td><td>1</td><td>1</td><td>1</td><td>[1]</td><td>1</td><td>[1]</td></tr><tr><td>1 input, 2 outputs, no batch</td><td>PD</td><td>1</td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1]</td><td><strong>2</strong></td><td>[1],[1]</td></tr><tr><td>2 inputs, 1 output, no batch</td><td>PD</td><td><strong>2</strong></td><td>1</td><td>1</td><td><strong>2</strong></td><td>[1],[1]</td><td>1</td><td>[1]</td></tr><tr><td>2 inputs, 2 outputs, no batch</td><td>PD</td><td><strong>2</strong></td><td><strong>2</strong></td><td>1</td><td><strong>2</strong></td><td>[1],[1]</td><td><strong>2</strong></td><td>[1],[1]</td></tr><tr><td>1 input, 1 output, <em>batch</em></td><td>NP</td><td>1</td><td>1</td><td>10</td><td>1</td><td>[10, 1]</td><td>1</td><td>[10, 1]</td></tr><tr><td>1 input, 2 outputs, <em>batch</em></td><td>NP</td><td>1</td><td><strong>2</strong></td><td>10</td><td>1</td><td>[10,1]</td><td>1</td><td>[10,<strong>2</strong>]</td></tr><tr><td>2 inputs, 1 output, <em>batch</em></td><td>NP</td><td><strong>2</strong></td><td>1</td><td>10</td><td>1</td><td>[10,<strong>2</strong>]</td><td>1</td><td>[10,1]</td></tr><tr><td>2 inputs, 2 outputs, <em>batch</em></td><td>NP</td><td><strong>2</strong></td><td><strong>2</strong></td><td>10</td><td>1</td><td>[10,<strong>2</strong>]</td><td>1</td><td>[10,<strong>2</strong>]</td></tr><tr><td>1 input, 1 output, <em>batch</em></td><td>PD</td><td>1</td><td>1</td><td>10</td><td>1</td><td>[1, 10]</td><td>1</td><td>[1, 10]</td></tr><tr><td>1 input, 2 outputs, <em>batch</em></td><td>PD</td><td>1</td><td><strong>2</strong></td><td>10</td><td>1</td><td>[1, 10]</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td></tr><tr><td>2 inputs, 1 output, <em>batch</em></td><td>PD</td><td><strong>2</strong></td><td>1</td><td>10</td><td>2</td><td>[1, 10],[1, 10]</td><td>1</td><td>[1, 10]</td></tr><tr><td>2 inputs, 2 outputs, <em>batch</em></td><td>PD</td><td><strong>2</strong></td><td><strong>2</strong></td><td>10</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td></tr></tbody></table><p>Which schemas have $>1$ I/O counts?</p><table><thead><tr><th>Scenario</th><th>Format</th><th># Input features</th><th># Output features</th><th>Batch size</th><th>Top inputs count</th><th>Input(s) shape</th><th>Top output counts</th><th>Output(s) shape</th></tr></thead><tbody><tr><td>1 input, 2 outputs, no batch</td><td>PD</td><td>1</td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1]</td><td><strong>2</strong></td><td>[1],[1]</td></tr><tr><td>2 inputs, 1 output, no batch</td><td>PD</td><td><strong>2</strong></td><td>1</td><td>1</td><td><strong>2</strong></td><td>[1],[1]</td><td>1</td><td>[1]</td></tr><tr><td>2 inputs, 2 outputs, no batch</td><td>PD</td><td><strong>2</strong></td><td><strong>2</strong></td><td>1</td><td><strong>2</strong></td><td>[1],[1]</td><td><strong>2</strong></td><td>[1],[1]</td></tr><tr><td>1 input, 2 outputs, <em>batch</em></td><td>PD</td><td>1</td><td><strong>2</strong></td><td>10</td><td>1</td><td>[1, 10]</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td></tr><tr><td>2 inputs, 1 output, <em>batch</em></td><td>PD</td><td><strong>2</strong></td><td>1</td><td>10</td><td>2</td><td>[1, 10],[1, 10]</td><td>1</td><td>[1, 10]</td></tr><tr><td>2 inputs, 2 outputs, <em>batch</em></td><td>PD</td><td><strong>2</strong></td><td><strong>2</strong></td><td>10</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td></tr></tbody></table><p><em>If</em> the input/output counts are $>1$, then we definitely have a PD payload. This is regardless of batch size.</p><p>Which schemas have $=1$ I/O counts?</p><table><thead><tr><th>Scenario</th><th>Format</th><th># Input features</th><th># Output features</th><th>Batch size</th><th>Top inputs count</th><th>Input(s) shape</th><th>Top output counts</th><th>Output(s) shape</th></tr></thead><tbody><tr><td>1 input, 1 output, no batch</td><td>NP</td><td>1</td><td>1</td><td>1</td><td>1</td><td>[1]</td><td>1</td><td>[1]</td></tr><tr><td>1 input, 2 outputs, no batch</td><td>NP</td><td>1</td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1,1]</td><td>1</td><td>[1,<strong>2</strong>]</td></tr><tr><td>2 inputs, 1 output, no batch</td><td>NP</td><td><strong>2</strong></td><td>1</td><td>1</td><td>1</td><td>[1,<strong>2</strong>]</td><td>1</td><td>[1,1]</td></tr><tr><td>2 inputs, 2 outputs, no batch</td><td>NP</td><td><strong>2</strong></td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1,<strong>2</strong>]</td><td>1</td><td>[1,<strong>2</strong>]</td></tr><tr><td>1 input, 1 output, no batch</td><td>PD</td><td>1</td><td>1</td><td>1</td><td>1</td><td>[1]</td><td>1</td><td>[1]</td></tr><tr><td>1 input, 1 output, <em>batch</em></td><td>NP</td><td>1</td><td>1</td><td>10</td><td>1</td><td>[10, 1]</td><td>1</td><td>[10, 1]</td></tr><tr><td>1 input, 2 outputs, <em>batch</em></td><td>NP</td><td>1</td><td><strong>2</strong></td><td>10</td><td>1</td><td>[10,1]</td><td>1</td><td>[10,<strong>2</strong>]</td></tr><tr><td>2 inputs, 1 output, <em>batch</em></td><td>NP</td><td><strong>2</strong></td><td>1</td><td>10</td><td>1</td><td>[10,<strong>2</strong>]</td><td>1</td><td>[10,1]</td></tr><tr><td>2 inputs, 2 outputs, <em>batch</em></td><td>NP</td><td><strong>2</strong></td><td><strong>2</strong></td><td>10</td><td>1</td><td>[10,<strong>2</strong>]</td><td>1</td><td>[10,<strong>2</strong>]</td></tr><tr><td>1 input, 1 output, <em>batch</em></td><td>PD</td><td>1</td><td>1</td><td>10</td><td>1</td><td>[1, 10]</td><td>1</td><td>[1, 10]</td></tr></tbody></table><p>If the top input/ouput counts are $=1$, then we definitely have an NP (the PD in there just means a 1 input, 1 output PD, which is indistinguishable).</p><p>Let&rsquo;s look at the inputs only. The first case is when the count is $=1$.</p><table><thead><tr><th>Scenario</th><th>Format</th><th># Input features</th><th># Output features</th><th>Batch size</th><th>Top inputs count</th><th>Input(s) shape</th><th>Top output counts</th><th>Output(s) shape</th></tr></thead><tbody><tr><td>1 input, 1 output, no batch</td><td>NP</td><td>1</td><td>1</td><td>1</td><td>1</td><td>[0,1]</td><td>1</td><td>[1]</td></tr><tr><td>1 input, 2 outputs, no batch</td><td>NP</td><td>1</td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1,1]</td><td>1</td><td>[1,<strong>2</strong>]</td></tr><tr><td>2 inputs, 1 output, no batch</td><td>NP</td><td><strong>2</strong></td><td>1</td><td>1</td><td>1</td><td>[1,<strong>2</strong>]</td><td>1</td><td>[1,1]</td></tr><tr><td>2 inputs, 2 outputs, no batch</td><td>NP</td><td><strong>2</strong></td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1,<strong>2</strong>]</td><td>1</td><td>[1,<strong>2</strong>]</td></tr><tr><td>1 input, 1 output, no batch</td><td>PD</td><td>1</td><td>1</td><td>1</td><td>1</td><td>[1]</td><td>1</td><td>[1]</td></tr><tr><td>1 input, 2 outputs, no batch</td><td>PD</td><td>1</td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1]</td><td><strong>2</strong></td><td>[1],[1]</td></tr><tr><td>1 input, 1 output, <em>batch</em></td><td>NP</td><td>1</td><td>1</td><td>10</td><td>1</td><td>[10, 1]</td><td>1</td><td>[10, 1]</td></tr><tr><td>1 input, 2 outputs, <em>batch</em></td><td>NP</td><td>1</td><td><strong>2</strong></td><td>10</td><td>1</td><td>[10,1]</td><td>1</td><td>[10,<strong>2</strong>]</td></tr><tr><td>2 inputs, 1 output, <em>batch</em></td><td>NP</td><td><strong>2</strong></td><td>1</td><td>10</td><td>1</td><td>[10,<strong>2</strong>]</td><td>1</td><td>[10,1]</td></tr><tr><td>2 inputs, 2 outputs, <em>batch</em></td><td>NP</td><td><strong>2</strong></td><td><strong>2</strong></td><td>10</td><td>1</td><td>[10,<strong>2</strong>]</td><td>1</td><td>[10,<strong>2</strong>]</td></tr><tr><td>1 input, 1 output, <em>batch</em></td><td>PD</td><td>1</td><td>1</td><td>10</td><td>1</td><td>[1, 10]</td><td>1</td><td>[1, 10]</td></tr><tr><td>1 input, 2 outputs, <em>batch</em></td><td>PD</td><td>1</td><td><strong>2</strong></td><td>10</td><td>1</td><td>[1, 10]</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td></tr></tbody></table><p>Now let&rsquo;s look at the case were $>1$</p><table><thead><tr><th>Scenario</th><th>Format</th><th># Input features</th><th># Output features</th><th>Batch size</th><th>Top inputs count</th><th>Input(s) shape</th><th>Top output counts</th><th>Output(s) shape</th></tr></thead><tbody><tr><td>2 inputs, 1 output, no batch</td><td>PD</td><td><strong>2</strong></td><td>1</td><td>1</td><td><strong>2</strong></td><td>[1],[1]</td><td>1</td><td>[1]</td></tr><tr><td>2 inputs, 2 outputs, no batch</td><td>PD</td><td><strong>2</strong></td><td><strong>2</strong></td><td>1</td><td><strong>2</strong></td><td>[1],[1]</td><td><strong>2</strong></td><td>[1],[1]</td></tr><tr><td>2 inputs, 1 output, <em>batch</em></td><td>PD</td><td><strong>2</strong></td><td>1</td><td>10</td><td>2</td><td>[1, 10],[1, 10]</td><td>1</td><td>[1, 10]</td></tr><tr><td>2 inputs, 2 outputs, <em>batch</em></td><td>PD</td><td><strong>2</strong></td><td><strong>2</strong></td><td>10</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td></tr></tbody></table><p>Logic:</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
	A{Input count = 1?} --&gt;|Yes| B{Shape 0 &gt; 1}
	B --&gt;|Yes| D[NP batch]
	B --&gt;|No| C{Just one\nelement?}
	C --&gt;|No| F[Either NP, no batch, multi-featute\nOR\nPD, batch, 1 feature]
	C --&gt;|Yes| G[1 feature, no batch]
	A --&gt;|No| H{Single element\nshapes?}
	H --&gt;|Yes| I[Multi-feature\nPD\nNo batch]
	H --&gt;|No| J[Multi-feature\nPD\nBatch]
</code></pre><p>Regarding the outputs, let&rsquo;s first look at the case where the output counts are $=1$</p><table><thead><tr><th>Scenario</th><th>Format</th><th># Input features</th><th># Output features</th><th>Batch size</th><th>Top inputs count</th><th>Input(s) shape</th><th>Top output counts</th><th>Output(s) shape</th></tr></thead><tbody><tr><td>1 input, 1 output, no batch</td><td>NP</td><td>1</td><td>1</td><td>1</td><td>1</td><td>[1]</td><td>1</td><td>[1]</td></tr><tr><td>1 input, 2 outputs, no batch</td><td>NP</td><td>1</td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1,1]</td><td>1</td><td>[1,<strong>2</strong>]</td></tr><tr><td>2 inputs, 1 output, no batch</td><td>NP</td><td><strong>2</strong></td><td>1</td><td>1</td><td>1</td><td>[1,<strong>2</strong>]</td><td>1</td><td>[1,1]</td></tr><tr><td>2 inputs, 2 outputs, no batch</td><td>NP</td><td><strong>2</strong></td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1,<strong>2</strong>]</td><td>1</td><td>[1,<strong>2</strong>]</td></tr><tr><td>1 input, 1 output, no batch</td><td>PD</td><td>1</td><td>1</td><td>1</td><td>1</td><td>[1]</td><td>1</td><td>[1]</td></tr><tr><td>2 inputs, 1 output, no batch</td><td>PD</td><td><strong>2</strong></td><td>1</td><td>1</td><td><strong>2</strong></td><td>[1],[1]</td><td>1</td><td>[1]</td></tr><tr><td>1 input, 1 output, <em>batch</em></td><td>NP</td><td>1</td><td>1</td><td>10</td><td>1</td><td>[10, 1]</td><td>1</td><td>[10, 1]</td></tr><tr><td>1 input, 2 outputs, <em>batch</em></td><td>NP</td><td>1</td><td><strong>2</strong></td><td>10</td><td>1</td><td>[10,1]</td><td>1</td><td>[10,<strong>2</strong>]</td></tr><tr><td>2 inputs, 1 output, <em>batch</em></td><td>NP</td><td><strong>2</strong></td><td>1</td><td>10</td><td>1</td><td>[10,<strong>2</strong>]</td><td>1</td><td>[10,1]</td></tr><tr><td>2 inputs, 2 outputs, <em>batch</em></td><td>NP</td><td><strong>2</strong></td><td><strong>2</strong></td><td>10</td><td>1</td><td>[10,<strong>2</strong>]</td><td>1</td><td>[10,<strong>2</strong>]</td></tr><tr><td>1 input, 1 output, <em>batch</em></td><td>PD</td><td>1</td><td>1</td><td>10</td><td>1</td><td>[1, 10]</td><td>1</td><td>[1, 10]</td></tr></tbody></table><p>We can see the same logic as in the inputs. When the output counts $>1$:</p><table><thead><tr><th>Scenario</th><th>Format</th><th># Input features</th><th># Output features</th><th>Batch size</th><th>Top inputs count</th><th>Input(s) shape</th><th>Top output counts</th><th>Output(s) shape</th></tr></thead><tbody><tr><td>1 input, 2 outputs, no batch</td><td>PD</td><td>1</td><td><strong>2</strong></td><td>1</td><td>1</td><td>[1]</td><td><strong>2</strong></td><td>[1],[1]</td></tr><tr><td>2 inputs, 2 outputs, no batch</td><td>PD</td><td><strong>2</strong></td><td><strong>2</strong></td><td>1</td><td><strong>2</strong></td><td>[1],[1]</td><td><strong>2</strong></td><td>[1],[1]</td></tr><tr><td>1 input, 2 outputs, <em>batch</em></td><td>PD</td><td>1</td><td><strong>2</strong></td><td>10</td><td>1</td><td>[1, 10]</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td></tr><tr><td>2 inputs, 2 outputs, <em>batch</em></td><td>PD</td><td><strong>2</strong></td><td><strong>2</strong></td><td>10</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td><td><strong>2</strong></td><td>[1, 10],[1, 10]</td></tr></tbody></table><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
	A{Output count = 1?} --&gt;|Yes| B{Shape 0 &gt; 1}
	B --&gt;|Yes| D[NP batch]
	B --&gt;|No| C{Just one\nelement?}
	C --&gt;|No| F[Either NP, no batch, multi-featute\nOR\nPD, batch, 1 feature]
	C --&gt;|Yes| G[1 feature, no batch]
	A --&gt;|No| H{Single element\nshapes?}
	H --&gt;|Yes| I[Multi-feature\nPD\nNo batch]
	H --&gt;|No| J[Multi-feature\nPD\nBatch]
</code></pre><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://github.com/trustyai-explainability/trustyai-explainability>https://github.com/trustyai-explainability/trustyai-explainability</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li><li><a href=/draw/>Drawings</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#synopsis>Synopsis</a><ul><li><a href=#single-input>Single input</a></li><li><a href=#multiple-inputs>Multiple inputs</a></li></ul></li><li><a href=#dataframe-utilities>Dataframe utilities</a></li><li><a href=#schemas>Schemas</a></li></ul></nav></div><div id=share-footer style=display:none></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 Rui Vieira</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/map/>All pages</a></li><li><a href=/search.html>Search</a></li><li><a href=/draw/>Drawings</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/css/fa.min.css><script src=/js/jquery-3.6.0.min.js></script>
<script src=/js/mark.min.js></script>
<script src=/js/main.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>